"use strict";(self.webpackChunksc_envimonitor=self.webpackChunksc_envimonitor||[]).push([[89613],{3663:(e,t,i)=>{i.d(t,{O:()=>n});var r=i(18690),s=i(19276),a=i(85632);function n(e){var t,i,n;if(!e)return[];let l=(0,a.DU)(e)?[e]:s.A.isCollection(e)?e.toArray():Array.isArray(e)?e:[];return l=null===(t=l)||void 0===t?void 0:t.filter(r.Ru),0===(null!==(i=null===(n=l)||void 0===n?void 0:n.length)&&void 0!==i?i:0)?[]:l}},4722:(e,t,i)=>{i.d(t,{r:()=>y});var r=i(35143),s=i(69539),a=i(91967),n=i(18690),l=i(54901),h=i(68134),o=i(46053),d=(i(81806),i(76460),i(85842)),u=i(9956),p=i(64519),g=i(86875),c=i(7246),w=i(76940),v=i(3663);let y=class extends a.A{get updating(){var e,t;return null!==(e=null===(t=this.graphicsView)||void 0===t?void 0:t.updating)&&void 0!==e&&e}constructor(e){super(e),this._highlightCounts=new Map,this._graphicsViewLoader=null,this.graphics=new p.Y,this.graphicsView=null,this.suspended=!1;const t=new s.A([255,255,255,1/255]);this._symbols=new Map([["point",new w.A({size:"2px",style:"square",color:t})],["polyline",new c.A({width:"2px",color:t})],["polygon",new g.A({outline:null,color:t})]])}highlight(e,t){const i=(0,v.O)(e);if(0===i.length)return(0,l.hA)();let r,s=!1;return this.updatingHandles.addPromise(Promise.all([this._createHighlightGraphics(i),this._ensureGraphicsView3D()]).then(e=>{let[i,a]=e;!s&&a&&(r=this._addHighlightGraphics(a,i,t))})),(0,l.hA)(()=>{var e;s=!0,null===(e=r)||void 0===e||e.remove()})}preload(){this._ensureGraphicsView3D()}_addHighlightGraphics(e,t,i){for(const a of t){var r;this._highlightCounts.set(a,(null!==(r=this._highlightCounts.get(a))&&void 0!==r?r:0)+1)}this.graphics.addMany(t);const s=e.highlight(t,i);return(0,l.hA)(()=>{this._removeHighlightGraphics(t),s.remove()})}_removeHighlightGraphics(e){this.graphics.removeMany(e.filter(e=>{var t;const i=Math.max(0,(null!==(t=this._highlightCounts.get(e))&&void 0!==t?t:0)-1);return 0===i?(this._highlightCounts.delete(e),!0):(this._highlightCounts.set(e,i),!1)}))}async _ensureGraphicsView3D(){if(this.graphicsView)return this.graphicsView;this._graphicsViewLoader||(this._graphicsViewLoader=Promise.all([i.e(31918),i.e(53046),i.e(15477)]).then(i.bind(i,15477)));const{default:e}=await this._graphicsViewLoader;if(this.destroyed)return null;const t=new e({view:this.view,layer:this.layer,getGraphics:()=>this.graphics,drapeSourcePriorityOffset:.5});return this._set("graphicsView",t),this.addHandles([(0,l.DQ)(this.graphicsView),(0,h.wB)(()=>this.suspended,e=>{t.suspended=e},h.pc)]),t}async _createHighlightGraphics(e){const t=e.map(e=>{let{geometry:t}=e;return null===t||void 0===t?void 0:t.spatialReference}).filter(n.Ru).reduce((e,t)=>{var i;return 0!==e.length&&null!==(i=e.at(-1))&&void 0!==i&&i.equals(t)||e.push(t),e},[]),i=this.view.spatialReference,r=t.map(e=>({source:e,dest:i}));try{await(0,u.initializeProjection)(r)}catch(s){return[]}return e.map(e=>{const{geometry:t}=e;try{const r=t?(0,u.project)(t,i):null,s=e.cloneShallow();return s.geometry=r,s.symbol=this._symbols.get(null===r||void 0===r?void 0:r.type),s}catch(r){return e}})}};(0,r._)([(0,o.MZ)()],y.prototype,"graphics",void 0),(0,r._)([(0,o.MZ)()],y.prototype,"graphicsView",void 0),(0,r._)([(0,o.MZ)()],y.prototype,"view",void 0),(0,r._)([(0,o.MZ)()],y.prototype,"layer",void 0),(0,r._)([(0,o.MZ)()],y.prototype,"updatingHandles",void 0),(0,r._)([(0,o.MZ)()],y.prototype,"suspended",void 0),(0,r._)([(0,o.MZ)()],y.prototype,"updating",null),y=(0,r._)([(0,d.$)("esri.views.3d.layers.support.ImageHighlightHelper3D")],y)},17214:(e,t,i)=>{i.d(t,{A:()=>g});var r=i(35143),s=i(50076),a=i(50346),n=i(46053),l=(i(81806),i(76460),i(47249),i(85842)),h=i(19247),o=i(31516),d=i(59844),u=i(97015),p=i(2257);const g=e=>{let t=class extends e{constructor(){super(...arguments),this.view=null}get timeExtent(){var e;return(0,o.F)(this.layer,null===(e=this.view)||void 0===e?void 0:e.timeExtent,this._get("timeExtent"))}async fetchPopupFeaturesAtLocation(e,t){const{layer:i}=this;if(!e)throw new s.A("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:i});const{popupEnabled:r}=i,n=(0,p.D8)(i,t);if(!r||null==n)return[];const l=await n.getRequiredFields();(0,a.Te)(t);const o=new u.A;o.timeExtent=this.timeExtent,o.geometry=e,o.outFields=l,o.outSpatialReference=e.spatialReference;const{resolution:d,spatialReference:g}=this.view,c="2d"===this.view.type?new h.A(d,d,g):new h.A(.5*d,.5*d,g),{returnTopmostRaster:w,showNoDataRecords:v}=n.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},y={returnDomainValues:!0,returnTopmostRaster:w,pixelSize:c,showNoDataRecords:v,signal:null===t||void 0===t?void 0:t.signal};return i.queryVisibleRasters(o,y).then(e=>e)}async getSourceScale(){return await(0,d.Hh)(),await this.layer.load(),(0,d.OO)(this.layer.serviceRasterInfo,this.view.spatialReference)}canResume(){var e;return!!super.canResume()&&!(null!==(e=this.timeExtent)&&void 0!==e&&e.isEmpty)}};return(0,r._)([(0,n.MZ)()],t.prototype,"layer",void 0),(0,r._)([(0,n.MZ)()],t.prototype,"suspended",void 0),(0,r._)([(0,n.MZ)({readOnly:!0})],t.prototype,"timeExtent",null),(0,r._)([(0,n.MZ)()],t.prototype,"view",void 0),t=(0,r._)([(0,l.$)("esri.views.layers.ImageryLayerView")],t),t}},89613:(e,t,i)=>{i.r(t),i.d(t,{default:()=>y});var r=i(35143),s=i(54901),a=i(81806),n=i(68134),l=i(46053),h=(i(76460),i(47249),i(85842)),o=i(98774),d=i(74283),u=i(50346),p=(i(50076),i(44882));let g=class extends p.A{constructor(e){super(e),this.redrawDebounced=(0,u.sg)(async e=>{this.redraw((e,t)=>this._redrawImage(e,t),e)},2e3)}initialize(){this.addHandles([(0,n.z7)(()=>this.view.basemapTerrain.ready,()=>this._initializeMaximumDataResolution(),{once:!0,initial:!0}),this.layer.on("redraw",()=>this.updatingHandles.addPromise(this.redrawDebounced()))])}_initializeMaximumDataResolution(){this.maximumDataResolution=this.layer.loaded?this.layer.serviceRasterInfo.pixelSize:null}async processResult(e,t,i){t.imageOrCanvasElement?e.image=t.imageOrCanvasElement:(e.image=document.createElement("canvas"),e.pixelData=t.pixelData,await this._redrawImage(e,i))}async _redrawImage(e,t){if(!(e.image instanceof HTMLCanvasElement)||null==e.pixelData)throw new Error;const i=e.image,r=i.getContext("2d"),s=await this.layer.applyRenderer(e.pixelData,{signal:t}),a=this.layer.applyFilter(s).pixelBlock;if(null==a)throw new Error;i.width=a.width,i.height=a.height;const n=r.createImageData(a.width,a.height);n.data.set(a.getAsRGBA()),r.putImageData(n,0,0)}};g=(0,r._)([(0,h.$)("esri.views.3d.layers.ImagerySubView3D")],g);var c=i(4722),w=i(17214);let v=class extends((0,w.A)(o.A)){constructor(){super(...arguments),this.type="imagery-3d"}get highlightOptions(){return null}get pixelData(){return null}initialize(){const e=()=>this._updatingHandles.addPromise(this.refreshDebounced());this._updatingHandles.add(()=>{var e;return null===(e=this.layer)||void 0===e||null===(e=e.exportImageServiceParameters)||void 0===e?void 0:e.version},e),this._updatingHandles.add(()=>{var e;return null===(e=this.layer)||void 0===e?void 0:e.renderer},e),this._updatingHandles.add(()=>this.timeExtent,e),this._highlightHelper=new c.r({view:this.view,layer:this.layer,updatingHandles:this._updatingHandles}),this.addHandles([(0,s.DQ)(this._highlightHelper),(0,n.wB)(()=>this.suspended,e=>this._highlightHelper.suspended=e,n.pc)])}_initSubView(){this.addHandles([(0,n.wB)(()=>this.layer.renderer,e=>this._recreateSubView(e),n.Vh)])}_recreateSubView(e){var t;const i="flow"===(null===e||void 0===e?void 0:e.type),r="flow"===(null===(t=this.subView)||void 0===t?void 0:t.type),s=this.subView;s&&i===r||(this.subView=i&&(0,a.A)("enable-feature:3d-flow")?new d.A({layerView:this}):new g({layerView:this}),null===s||void 0===s||s.destroy())}getFetchOptions(){return{timeExtent:this.timeExtent}}highlight(e,t){return this._highlightHelper.highlight(e,t)}isUpdating(){return super.isUpdating()||this._highlightHelper.updating}};(0,r._)([(0,l.MZ)()],v.prototype,"highlightOptions",null),(0,r._)([(0,l.MZ)()],v.prototype,"pixelData",null),v=(0,r._)([(0,h.$)("esri.views.3d.layers.ImageryLayerView3D")],v);const y=v}}]);
//# sourceMappingURL=89613.b1ce4036.chunk.js.map