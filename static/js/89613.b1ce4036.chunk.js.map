{"version":3,"file":"static/js/89613.b1ce4036.chunk.js","mappings":"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","sources":["../node_modules/@arcgis/core/views/layers/support/highlightUtils.js","../node_modules/@arcgis/core/views/3d/layers/support/ImageHighlightHelper3D.js","../node_modules/@arcgis/core/views/layers/ImageryLayerView.js","../node_modules/@arcgis/core/views/3d/layers/ImagerySubView3D.js","../node_modules/@arcgis/core/views/3d/layers/ImageryLayerView3D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{isSome as r}from\"../../../core/arrayUtils.js\";import o from\"../../../core/Collection.js\";import{isGraphic as t}from\"../../../support/guards.js\";function i(i){if(!i)return[];let e=t(i)?[i]:o.isCollection(i)?i.toArray():Array.isArray(i)?i:[];return e=e?.filter(r),0===(e?.length??0)?[]:e}export{i as getHighlightGraphics};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../../chunks/tslib.es6.js\";import e from\"../../../../Color.js\";import i from\"../../../../core/Accessor.js\";import{isSome as s}from\"../../../../core/arrayUtils.js\";import{makeHandle as r,destroyHandle as o}from\"../../../../core/handleUtils.js\";import{watch as h,syncAndInitial as p}from\"../../../../core/reactiveUtils.js\";import{property as a}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/Logger.js\";import{subclass as l}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{initializeProjection as c,project as n}from\"../../../../geometry/projectionUtils.js\";import{GraphicsCollection as g}from\"../../../../support/GraphicsCollection.js\";import m from\"../../../../symbols/SimpleFillSymbol.js\";import u from\"../../../../symbols/SimpleLineSymbol.js\";import d from\"../../../../symbols/SimpleMarkerSymbol.js\";import{getHighlightGraphics as y}from\"../../../layers/support/highlightUtils.js\";let w=class extends i{get updating(){return this.graphicsView?.updating??!1}constructor(t){super(t),this._highlightCounts=new Map,this._graphicsViewLoader=null,this.graphics=new g,this.graphicsView=null,this.suspended=!1;const i=new e([255,255,255,1/255]);this._symbols=new Map([[\"point\",new d({size:\"2px\",style:\"square\",color:i})],[\"polyline\",new u({width:\"2px\",color:i})],[\"polygon\",new m({outline:null,color:i})]])}highlight(t,e){const i=y(t);if(0===i.length)return r();let s,o=!1;return this.updatingHandles.addPromise(Promise.all([this._createHighlightGraphics(i),this._ensureGraphicsView3D()]).then((([t,i])=>{!o&&i&&(s=this._addHighlightGraphics(i,t,e))}))),r((()=>{o=!0,s?.remove()}))}preload(){this._ensureGraphicsView3D()}_addHighlightGraphics(t,e,i){for(const r of e)this._highlightCounts.set(r,(this._highlightCounts.get(r)??0)+1);this.graphics.addMany(e);const s=t.highlight(e,i);return r((()=>{this._removeHighlightGraphics(e),s.remove()}))}_removeHighlightGraphics(t){this.graphics.removeMany(t.filter((t=>{const e=Math.max(0,(this._highlightCounts.get(t)??0)-1);return 0===e?(this._highlightCounts.delete(t),!0):(this._highlightCounts.set(t,e),!1)})))}async _ensureGraphicsView3D(){if(this.graphicsView)return this.graphicsView;this._graphicsViewLoader||(this._graphicsViewLoader=import(\"../GraphicsView3D.js\"));const{default:t}=await this._graphicsViewLoader;if(this.destroyed)return null;const e=new t({view:this.view,layer:this.layer,getGraphics:()=>this.graphics,drapeSourcePriorityOffset:.5});return this._set(\"graphicsView\",e),this.addHandles([o(this.graphicsView),h((()=>this.suspended),(t=>{e.suspended=t}),p)]),e}async _createHighlightGraphics(t){const e=t.map((({geometry:t})=>t?.spatialReference)).filter(s).reduce(((t,e)=>(0!==t.length&&t.at(-1)?.equals(e)||t.push(e),t)),[]),i=this.view.spatialReference,r=e.map((t=>({source:t,dest:i})));try{await c(r)}catch{return[]}return t.map((t=>{const{geometry:e}=t;try{const s=e?n(e,i):null,r=t.cloneShallow();return r.geometry=s,r.symbol=this._symbols.get(s?.type),r}catch{return t}}))}};t([a()],w.prototype,\"graphics\",void 0),t([a()],w.prototype,\"graphicsView\",void 0),t([a()],w.prototype,\"view\",void 0),t([a()],w.prototype,\"layer\",void 0),t([a()],w.prototype,\"updatingHandles\",void 0),t([a()],w.prototype,\"suspended\",void 0),t([a()],w.prototype,\"updating\",null),w=t([l(\"esri.views.3d.layers.support.ImageHighlightHelper3D\")],w);export{w as ImageHighlightHelper3D};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import t from\"../../core/Error.js\";import{throwIfAborted as r}from\"../../core/promiseUtils.js\";import{property as o}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/Logger.js\";import\"../../core/RandomLCG.js\";import{subclass as s}from\"../../core/accessorSupport/decorators/subclass.js\";import i from\"../../geometry/Point.js\";import{combineTimeExtent as a}from\"../../layers/support/timeSupport.js\";import{load as p,getSourceScale as n}from\"../../layers/support/rasterFunctions/rasterProjectionHelper.js\";import u from\"../../rest/support/Query.js\";import{getFetchPopupTemplate as c}from\"./support/popupUtils.js\";const m=m=>{let l=class extends m{constructor(){super(...arguments),this.view=null}get timeExtent(){return a(this.layer,this.view?.timeExtent,this._get(\"timeExtent\"))}async fetchPopupFeaturesAtLocation(e,o){const{layer:s}=this;if(!e)throw new t(\"imagerylayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:s});const{popupEnabled:a}=s,p=c(s,o);if(!a||null==p)return[];const n=await p.getRequiredFields();r(o);const m=new u;m.timeExtent=this.timeExtent,m.geometry=e,m.outFields=n,m.outSpatialReference=e.spatialReference;const{resolution:l,spatialReference:y}=this.view,h=\"2d\"===this.view.type?new i(l,l,y):new i(.5*l,.5*l,y),{returnTopmostRaster:f,showNoDataRecords:w}=p.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},d={returnDomainValues:!0,returnTopmostRaster:f,pixelSize:h,showNoDataRecords:w,signal:o?.signal};return s.queryVisibleRasters(m,d).then((e=>e))}async getSourceScale(){return await p(),await this.layer.load(),n(this.layer.serviceRasterInfo,this.view.spatialReference)}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}};return e([o()],l.prototype,\"layer\",void 0),e([o()],l.prototype,\"suspended\",void 0),e([o({readOnly:!0})],l.prototype,\"timeExtent\",null),e([o()],l.prototype,\"view\",void 0),l=e([s(\"esri.views.layers.ImageryLayerView\")],l),l};export{m as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import{debounce as a}from\"../../../core/promiseUtils.js\";import{when as i}from\"../../../core/reactiveUtils.js\";import\"../../../core/Logger.js\";import\"../../../core/has.js\";import\"../../../core/RandomLCG.js\";import\"../../../core/Error.js\";import{subclass as t}from\"../../../core/accessorSupport/decorators/subclass.js\";import r from\"./DrapedSubView3D.js\";let s=class extends r{constructor(e){super(e),this.redrawDebounced=a((async e=>{this.redraw(((e,a)=>this._redrawImage(e,a)),e)}),2e3)}initialize(){this.addHandles([i((()=>this.view.basemapTerrain.ready),(()=>this._initializeMaximumDataResolution()),{once:!0,initial:!0}),this.layer.on(\"redraw\",(()=>this.updatingHandles.addPromise(this.redrawDebounced())))])}_initializeMaximumDataResolution(){this.maximumDataResolution=this.layer.loaded?this.layer.serviceRasterInfo.pixelSize:null}async processResult(e,a,i){a.imageOrCanvasElement?e.image=a.imageOrCanvasElement:(e.image=document.createElement(\"canvas\"),e.pixelData=a.pixelData,await this._redrawImage(e,i))}async _redrawImage(e,a){if(!(e.image instanceof HTMLCanvasElement)||null==e.pixelData)throw new Error;const i=e.image,t=i.getContext(\"2d\"),r=await this.layer.applyRenderer(e.pixelData,{signal:a}),s=this.layer.applyFilter(r).pixelBlock;if(null==s)throw new Error;i.width=s.width,i.height=s.height;const o=t.createImageData(s.width,s.height);o.data.set(s.getAsRGBA()),t.putImageData(o,0,0)}};s=e([t(\"esri.views.3d.layers.ImagerySubView3D\")],s);export{s as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import{destroyHandle as t}from\"../../../core/handleUtils.js\";import has from\"../../../core/has.js\";import{watch as i,syncAndInitial as r,initial as s}from\"../../../core/reactiveUtils.js\";import{property as a}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/Logger.js\";import\"../../../core/RandomLCG.js\";import{subclass as o}from\"../../../core/accessorSupport/decorators/subclass.js\";import h from\"./DynamicLayerView3D.js\";import l from\"./FlowSubView3D.js\";import p from\"./ImagerySubView3D.js\";import{ImageHighlightHelper3D as n}from\"./support/ImageHighlightHelper3D.js\";import d from\"../../layers/ImageryLayerView.js\";let g=class extends(d(h)){constructor(){super(...arguments),this.type=\"imagery-3d\"}get highlightOptions(){return null}get pixelData(){return null}initialize(){const e=()=>this._updatingHandles.addPromise(this.refreshDebounced());this._updatingHandles.add((()=>this.layer?.exportImageServiceParameters?.version),e),this._updatingHandles.add((()=>this.layer?.renderer),e),this._updatingHandles.add((()=>this.timeExtent),e),this._highlightHelper=new n({view:this.view,layer:this.layer,updatingHandles:this._updatingHandles}),this.addHandles([t(this._highlightHelper),i((()=>this.suspended),(e=>this._highlightHelper.suspended=e),r)])}_initSubView(){this.addHandles([i((()=>this.layer.renderer),(e=>this._recreateSubView(e)),s)])}_recreateSubView(e){const t=\"flow\"===e?.type,i=\"flow\"===this.subView?.type,r=this.subView;r&&t===i||(this.subView=t&&has(\"enable-feature:3d-flow\")?new l({layerView:this}):new p({layerView:this}),r?.destroy())}getFetchOptions(){return{timeExtent:this.timeExtent}}highlight(e,t){return this._highlightHelper.highlight(e,t)}isUpdating(){return super.isUpdating()||this._highlightHelper.updating}};e([a()],g.prototype,\"highlightOptions\",null),e([a()],g.prototype,\"pixelData\",null),g=e([o(\"esri.views.3d.layers.ImageryLayerView3D\")],g);const m=g;export{m as default};\n"],"names":["i","_e","_e$length","_e2","e","t","o","isCollection","toArray","Array","isArray","filter","r","length","w","updating","_this$graphicsView$up","_this$graphicsView","this","graphicsView","constructor","super","_highlightCounts","Map","_graphicsViewLoader","graphics","g","suspended","_symbols","d","size","style","color","u","width","m","outline","highlight","y","s","updatingHandles","addPromise","Promise","all","_createHighlightGraphics","_ensureGraphicsView3D","then","_ref","_addHighlightGraphics","_s","remove","preload","_this$_highlightCount","set","get","addMany","_removeHighlightGraphics","removeMany","_this$_highlightCount2","Math","max","delete","default","destroyed","view","layer","getGraphics","drapeSourcePriorityOffset","_set","addHandles","h","p","map","_ref2","geometry","spatialReference","reduce","_t$at","at","equals","push","source","dest","c","_unused","n","cloneShallow","symbol","type","_unused2","a","prototype","l","arguments","timeExtent","_this$view","_get","fetchPopupFeaturesAtLocation","popupEnabled","getRequiredFields","outFields","outSpatialReference","resolution","returnTopmostRaster","f","showNoDataRecords","layerOptions","returnDomainValues","pixelSize","signal","queryVisibleRasters","getSourceScale","load","serviceRasterInfo","canResume","_this$timeExtent","isEmpty","readOnly","redrawDebounced","async","redraw","_redrawImage","initialize","basemapTerrain","ready","_initializeMaximumDataResolution","once","initial","on","maximumDataResolution","loaded","processResult","imageOrCanvasElement","image","document","createElement","pixelData","HTMLCanvasElement","Error","getContext","applyRenderer","applyFilter","pixelBlock","height","createImageData","data","getAsRGBA","putImageData","highlightOptions","_updatingHandles","refreshDebounced","add","_this$layer","exportImageServiceParameters","version","_this$layer2","renderer","_highlightHelper","_initSubView","_recreateSubView","_this$subView","subView","has","layerView","destroy","getFetchOptions","isUpdating"],"sourceRoot":""}