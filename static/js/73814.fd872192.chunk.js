"use strict";(self.webpackChunksc_envimonitor=self.webpackChunksc_envimonitor||[]).push([[73814],{73814:(e,t,r)=>{r.d(t,{load:()=>v});var a=r(50076),n=r(13096),l=r(11668),o=r(77491),i=r(31933),u=r(65308),s=r(79942),d=r(64130),c=r(72945),p=r(81589),y=r(67061);async function v(e,t){const r=e.instance.portalItem;if(null!==r&&void 0!==r&&r.id)return await r.load(t),function(e){const t=e.instance.portalItem;if(null===t||void 0===t||!t.type||!e.supportedTypes.includes(t.type))throw new a.A("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}'",{type:null===t||void 0===t?void 0:t.type,expectedType:e.supportedTypes.join(", ")})}(e),e.validateItem&&e.validateItem(r),async function(e,t){var r;const n=e.instance,u=n.portalItem;if(!u)return;let{url:v}=u;const{title:m}=u,h=(0,s.v)(u,"portal-item");if("group"===n.type)return async function(e,t,r){const n=e.portalItem;if(!e.sourceIsPortalItem)return;const{title:u,type:p}=n;if("Group Layer"===p){if(!(0,c.Y)(n,"Map"))throw new a.A("portal:invalid-layer-item-typekeyword","'Group Layer' item without 'Map' type keyword is not supported");return async function(e,t){var r;const n=e.portalItem,l=await n.fetchData("json");if(!l)return;if(!t.populateGroupLayer)throw new a.A("portal:missing-populate-group-layer","Missing populate group layer");const o=(0,s.v)(n,"web-map");e.read(l,o),await t.populateGroupLayer(e,l,{context:o}),e.resourceReferences={portalItem:n,paths:null!==(r=o.readResourcePaths)&&void 0!==r?r:[]}}(e,r)}return e.read({title:u},t),async function(e,t){let r;const{portalItem:n}=e;if(!n)return;const u=n.type,s=t.layerModuleTypeMap;if(!s)throw new a.A("portal:missing-layer-module-type-map","Layer module type map is required to construct sub layers");switch(u){case"Feature Service":case"Feature Collection":r=s.FeatureLayer;break;case"Stream Service":r=s.StreamLayer;break;case"Scene Service":r=s.SceneLayer;break;case"Video Service":r=s.VideoLayer;break;default:throw new a.A("portal:unsupported-item-type-as-group","The item type '".concat(u,"' is not supported as a 'IGroupLayer'"))}const c="Video Service"===u,p=new o.v;let[v,{data:m}]=await Promise.all([r(),c?{data:null}:w(t,p)]),h=()=>v;if(c)return async function(e,t,r){var a;const{portalItem:n}=e;if(null===n||void 0===n||!n.url)return;const l=await(0,y.V)(n.url);l&&f(e,t,null,{layers:null===(a=l.layers)||void 0===a?void 0:a.map(e=>{let{id:t,name:r}=e;return{id:t,name:r}})},r)}(e,h,s);if("Feature Service"===u){var g;const t=null===(g=(0,d.pJ)(m))||void 0===g?void 0:g.customParameters;m=n.url?(await(0,d.bO)(m,n.url,p)).data:{},h=await async function(e,t){const{layers:r,tables:a}=e,n=[...null!==r&&void 0!==r?r:[],...null!==a&&void 0!==a?a:[]];if(!n.length)return;const l=new Set,o=[];for(const{layerType:s}of n){const e=null!==s&&void 0!==s?s:"ArcGISFeatureLayer";if(l.has(e))continue;l.add(e);const r=t[(0,d.K8)(e)];o.push(r())}const i=await Promise.all(o),u=new Map;return Array.from(l).forEach((e,t)=>{u.set(e,i[t])}),e=>{let{layerType:t}=e;const r=null!==t&&void 0!==t?t:"ArcGISFeatureLayer";return u.get(r)}}(m,s)||h;const{provider:r,preferredHost:a}=await async function(e,t){const{layersJSON:r,preferredHost:a}=await(0,l.Q)(e,t);if(!r)return{provider:null,preferredHost:a};const n=[...r.layers,...r.tables];return{provider:e=>n.find(t=>t.id===e.id),preferredHost:a}}(n.url,{customParameters:t,loadContext:p});return(0,i.Gh)(n,a),await f(e,h,h,m,s,r)}return"Scene Service"===u&&n.url&&(m=await(0,d.nu)(n,m,p)),(0,d.XH)(m)>0?await f(e,h,null,m,s):await async function(e,t,r){var a,n;const{portalItem:l}=e;if(null===l||void 0===l||!l.url)return;const o=await(0,y.V)(l.url);o&&f(e,t,null,{layers:null===(a=o.layers)||void 0===a?void 0:a.map(d._r),tables:null===(n=o.tables)||void 0===n?void 0:n.map(d._r)},r)}(e,h,s)}(e,r)}(n,h,e);v&&"media"!==n.type&&n.read({url:v},h);const g=new o.v,{data:I,preferredHost:b}=await w(e,g,t);return v=u.url,"isUrlHostModified"in n&&(b?n.applyPreferredHost({preferredHost:b}):n.applyHostFromPortalItem()),I&&n.read(I,h),n.resourceReferences={portalItem:u,paths:null!==(r=h.readResourcePaths)&&void 0!==r?r:[]},"subtype-group"!==n.type&&n.read({title:m},h),(0,p.L)(n,h)}(e,t)}async function f(e,t,r,a,n,l){var o;let i=a.layers||[];const u=a.tables||[];if("Feature Collection"===(null===(o=e.portalItem)||void 0===o?void 0:o.type)?(i.forEach((e,t)=>{var r;e.id=t,"Table"===(null===e||void 0===e||null===(r=e.layerDefinition)||void 0===r?void 0:r.type)&&u.push(e)}),i=i.filter(e=>{var t;return"Table"!==(null===e||void 0===e||null===(t=e.layerDefinition)||void 0===t?void 0:t.type)})):(i.reverse(),u.reverse()),i.forEach(r=>{const n=null===l||void 0===l?void 0:l(r);if(n||!l){const l=m(e,t(r),a,r,n);e.add(l)}}),u.length){const t=r?null:await n.FeatureLayer();u.forEach(n=>{const o=null===l||void 0===l?void 0:l(n);if(o||!l){const l=m(e,r?r(n):t,a,n,o);e.tables.add(l)}})}}function m(e,t,r,a,n){const l=e.portalItem,o={portalItem:l.clone(),layerId:a.id};null!=a.url&&(o.url=a.url);const i=new t(o);if("sourceJSON"in i&&(i.sourceJSON=n),"subtype-group"!==i.type&&"catalog"!==i.type&&(i.sublayerTitleMode="service-name"),"Feature Collection"===l.type){const e={origin:"portal-item",portal:l.portal||u.A.getDefault()};i.read(a,e);const t=r.showLegend;null!=t&&i.read({showLegend:t},e)}return i}async function w(e,t,r){if(!1===e.supportsData)return{data:void 0};const a=e.instance,l=a.portalItem;if(!l)return{data:void 0};let o=null;try{o=await l.fetchData("json",r)}catch(p){}if(function(e){return"stream"!==e.type&&"layerId"in e}(a)){var u,s;let e=null;const{count:r,preferredHost:p}=await async function(e,t,r){var a,l,o,u,s,c,p,y,v;if(null!==t&&void 0!==t&&t.layers&&null!==t&&void 0!==t&&t.tables)return{count:(0,d.XH)(t)};const f=(0,n.qg)(e.url);if(!f)return{count:1};const m=f.url.path,w=await r.fetchServiceMetadata(m,{customParameters:null===(a=(0,d.pJ)(t))||void 0===a?void 0:a.customParameters}).catch(()=>null);return{count:(null!==(l=null!==(o=null===t||void 0===t||null===(u=t.layers)||void 0===u?void 0:u.length)&&void 0!==o?o:null===w||void 0===w||null===(s=w.layers)||void 0===s?void 0:s.length)&&void 0!==l?l:0)+(null!==(c=null!==(p=null===t||void 0===t||null===(y=t.tables)||void 0===y?void 0:y.length)&&void 0!==p?p:null===w||void 0===w||null===(v=w.tables)||void 0===v?void 0:v.length)&&void 0!==c?c:0),preferredHost:(0,i.OP)(e)?(0,i.G$)():null}}(l,o,t);if((0,i.Gh)(l,p),(null!==(u=o)&&void 0!==u&&u.layers||null!==(s=o)&&void 0!==s&&s.tables)&&r>0){var c;if(null==a.layerId){const e=(0,d.l)(a.type),t=null!==e&&void 0!==e&&e.length?(0,d.Ju)(o,e)[0]:(0,d.pJ)(o);t&&(a.layerId=t.id)}e=function(e,t){var r,a;const{layerId:n}=t,l=(null===(r=e.layers)||void 0===r?void 0:r.find(e=>e.id===n))||(null===(a=e.tables)||void 0===a?void 0:a.find(e=>e.id===n));return l&&function(e,t){const r="layerType"in e&&e.layerType,{type:a}=t;return!("feature"===a&&r&&"ArcGISFeatureLayer"!==e.layerType||"catalog"===a&&!r||"oriented-imagery"===a&&!r||"subtype-group"===a&&!r)}(l,t)?l:null}(o,a),"OrientedImageryLayer"===(null===(c=e)||void 0===c?void 0:c.layerType)&&"oriented-imagery"===a.type&&a.supportedSourceTypes.add("Feature Layer"),e&&null!=o.showLegend&&(e.showLegend=o.showLegend)}return r>1&&"sublayerTitleMode"in a&&"service-name"!==a.sublayerTitleMode&&(a.sublayerTitleMode="item-title-and-service-name"),{data:e,preferredHost:p}}return{data:o}}}}]);
//# sourceMappingURL=73814.fd872192.chunk.js.map