"use strict";(self.webpackChunksc_envimonitor=self.webpackChunksc_envimonitor||[]).push([[29954],{29954:(e,t,n)=>{n.r(t),n.d(t,{default:()=>De});var i=n(89379),o=n(35143),s=n(16868),a=n(69098),r=n(50076),l=n(77717),c=n(50346),u=n(68134),d=n(46053),p=(n(81806),n(76460)),m=(n(47249),n(85842)),f=n(25515),v=n(65624),g=n(31362),h=n(24709),y=n(11270),b=n(94729),w=n(84008),x=n(21617),C=n(5682),I=n(78817),S=n(95363),A=n(44135),D=n(51939),T=n(76797),L=n(65660),V=n(3825),M=n(86769);function N(e){return e.endsWith("?")?e.slice(0,-1):e}function R(e){return e.filter(e=>{let{coverageSubType:t}=e;return null==t||""===t||/^rectified(grid|dataset)/i.test(t)})}function P(e){const t={};for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];if(1!==i.nodeType)continue;const o=(0,M.vv)(i).toLowerCase();switch(o){case"title":case"abstract":t[o]=(0,M.mX)(i);break;case"identifier":t.id=(0,M.mX)(i);break;case"wgs84boundingbox":{const e=(0,M.pN)(i,"LowerCorner"),n=(0,M.pN)(i,"UpperCorner");t.lonLatEnvelope=new T.A({xmin:e[0],ymin:e[1],xmax:n[0],ymax:n[1],spatialReference:{wkid:4326}})}break;case"coveragesummary":t.coverageSummaries=t.coverageSummaries||[],t.coverageSummaries.push(P(i))}}return t}function E(e,t){if(e.coverageSummaries)for(let n=0;n<e.coverageSummaries.length;n++)e.coverageSummaries[n].abstract=e.coverageSummaries[n].abstract||e.abstract,e.coverageSummaries[n].lonLatEnvelope=e.coverageSummaries[n].lonLatEnvelope||e.lonLatEnvelope,e.coverageSummaries[n].title=e.coverageSummaries[n].title||e.title,E(e.coverageSummaries[n],t);null!=e.id&&t.push(e)}function O(e){var t,n,i;const o=(null===(t=(0,M.V6)(e.querySelector("Operation[name=GetCapabilities]"),"Get"))||void 0===t?void 0:t.getAttribute("xlink:href"))||"",s=(null===(n=(0,M.V6)(e.querySelector("Operation[name=DescribeCoverage]"),"Get"))||void 0===n?void 0:n.getAttribute("xlink:href"))||"",a=(null===(i=(0,M.V6)(e.querySelector("Operation[name=GetCoverage]"),"Get"))||void 0===i?void 0:i.getAttribute("xlink:href"))||"";return{getCapabilities:N(o),describeCoverage:N(s),getCoverage:N(a)}}function X(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=null;n="string"==typeof e?(new DOMParser).parseFromString(e,"text/xml"):e;let i=n.documentElement.getAttribute("version");"1.0"===i?i="1.0.0":"1.1"===i&&(i="1.1.0");const o=i||t||"1.0.0",s=o.slice(0,3);let a;if("2.0"===s)a=function(e){const t=(0,M.V6)(e,"ServiceIdentification"),n=(0,M.mX)(t,"Title"),i=(0,M.Dy)(t,"ServiceTypeVersion"),o=(0,M.Dy)(t,"Profile"),s=O((0,M.V6)(e,"OperationsMetadata")),a=(0,M.IC)(e,"Contents/CoverageSummary"),r=[];for(let c=0;c<a.length;c++){const e=a[c],t=(0,M.mX)(e,"CoverageId"),n=(0,M.V6)(e,"WGS84BoundingBox");let i;if(n){const e=(0,M.pN)(n,"LowerCorner"),t=(0,M.pN)(n,"UpperCorner");i=new T.A({xmin:e[0],ymin:e[1],xmax:t[0],ymax:t[1],spatialReference:{wkid:4326}})}const o=(0,M.mX)(e,"CoverageSubtype")||"RectifiedGridCoverage";r.push({id:t,lonLatEnvelope:i,coverageSubType:o})}const l=(0,M.V6)(e,"ServiceMetadata");return{name:n,supportedVersions:i,supportedFormats:(0,M.Dy)(l,"formatSupported"),supportedInterpolations:(0,M.Dy)(l,"interpolationSupported").concat((0,M.Dy)(l,"InterpolationSupported")),onlineResources:s,profiles:o,coverages:r,gridCoverages:R(r),version:"2.0.1"}}(n);else if("1.1"===s)a=function(e){const t=(0,M.mX)(e,"ServiceIdentification/Title"),n=(0,M.Dy)(e,"ServiceIdentification/ServiceTypeVersion"),i=O((0,M.V6)(e,"OperationsMetadata")),o=[],s=(0,M.V6)(e,"Contents");for(let r=0;r<s.childNodes.length;r++){const e=s.childNodes[r];1===e.nodeType&&(0,M.g7)(e,"CoverageSummary")&&E(P(e),o)}const a=(0,M.Dy)(s,"SupportedFormat");return{name:t,onlineResources:i,coverages:o,gridCoverages:R(o),supportedVersions:n,supportedFormats:a,version:"1.1.0"}}(n);else{if("1.0"!==s)throw new r.A("wcsraster:parsecapabilities","the capabilities version is not supported");a=function(e){var t,n,i,o,s,a;const r=(0,M.mX)(e,"Service/name"),l=(0,M.V6)(e,"Capability"),c=null!==(t=null===(n=(0,M.V6)(l,"GetCapabilities/Get/OnlineResource"))||void 0===n?void 0:n.getAttribute("xlink:href"))&&void 0!==t?t:"",u=null!==(i=null===(o=(0,M.V6)(l,"DescribeCoverage/Get/OnlineResource"))||void 0===o?void 0:o.getAttribute("xlink:href"))&&void 0!==i?i:"",d=null!==(s=null===(a=(0,M.V6)(l,"GetCoverage/Get/OnlineResource"))||void 0===a?void 0:a.getAttribute("xlink:href"))&&void 0!==s?s:"",p={getCapabilities:N(c),describeCoverage:N(u),getCoverage:N(d)},m=(0,M.IC)(e,"CoverageOfferingBrief"),f=[];for(let v=0;v<m.length;v++){const e=m[v],t=(0,M.mX)(e,"name"),n=(0,M.IC)(e,"pos"),i=(0,M.pN)(n[0]),o=(0,M.pN)(n[1]),s=new T.A({xmin:i[0],ymin:i[1],xmax:o[0],ymax:o[1],spatialReference:{wkid:4326}});f.push({id:t,lonLatEnvelope:s})}return{name:r,onlineResources:p,coverages:f,gridCoverages:R(f),supportedVersions:["1.0.0"],version:"1.0.0"}}(n)}return a.version=o,a}var _=n(65215),k=n(23032),F=n(68347);function G(e){e.variables.forEach(e=>e.dimensions.forEach(e=>{var t;return null!==(t=e.values)&&void 0!==t?t:e.values=(0,F.Xg)(e)}))}function B(e){return{requestResponseCRSs:(0,M.Dy)(e,"requestResponseCRSs").map(e=>e.split(":")[1]),nativeCRSs:(0,M.Dy)(e,"nativeCRSs").map(e=>e.split(":")[1])}}function j(e,t){const n=(0,M.Dy)(e,"1.0.0"===t?"interpolationMethod":"InterpolationMethod"),i="1.0.0"===t?e.getAttribute("default"):(0,M.mX)(e,"InterpolationMethods/Default");return null!=i?[i].concat(n.filter(e=>e.toLowerCase()!==i.toLowerCase())):n}function W(e){return null==e?["nearest"]:e.map(e=>{const t=e.toLowerCase();return t.includes("nearest")?"nearest":t.includes("linear")?"bilinear":t.includes("cubic")?"cubic":null}).filter(e=>!!e)}function q(e){const t=(0,M.IC)(e,"pos"),n=(0,M.pN)(t[0]),i=(0,M.pN)(t[1]);return new T.A({xmin:n[0],ymin:n[1],xmax:i[0],ymax:i[1],spatialReference:{wkid:4326}})}function Z(e,t){const n=(0,M.Dy)(e,t);return null!==n&&void 0!==n&&n.length&&""!==n[0]&&!isNaN(Number(n[0]))?n.map(e=>Number(e)):null}function U(e){const t=(0,M.pN)(e,"MinimumValue"),n=(0,M.pN)(e,"MaximumValue");return t.length&&n.length?t.map((e,t)=>({min:e,max:n[t],avg:-1,stddev:-1})):null}function z(e){return null==e?null:e.every(t=>t===e[0])?e[0]:e}function H(e){const t=[],n=(0,M.IC)(e,"RangeSet");let i=[];for(let o=0;o<n.length;o++){const e=(0,M.mX)(n[o],"name"),s=(0,M.mX)(n[o],"label"),a=[],r=Z(n[o],"nullValues/singleValue"),l=(0,M.IC)(n[o],"AxisDescription");for(let t=0;t<l.length;t++){const e=(0,M.mX)(l[t],"name"),n=(0,M.mX)(l[t],"label"),o=(0,M.Dy)(l[t],"singleValue");if(0===o.length){const e=(0,M.mX)(l[t],"min"),n=(0,M.mX)(l[t],"max"),i=Number((0,M.mX)(l[t],"res"))||1;if(null!==e&&null!==n)for(let t=parseInt(e,10);t<=parseInt(n,10);t+=i)o.push(t.toString())}"band"===e.toLowerCase()&&(i=o),a.push({name:e,label:n,values:o})}t.push({name:e,label:s,nullValues:r,axis:a})}return{rangeSet:t,bandNames:i}}function $(e){const t=(0,M.IC)(e,"timeposition");if(t.length>0){const e=[];for(let n=0;n<t.length;n++)e.push(new Date((0,M.mX)(t[n])));return{begin:e[0],end:e[e.length-1],values:e}}const n=(0,M.V6)(e,"timePeriod")||(0,M.V6)(e,"TimePeriod");return n?(0,i.A)({begin:new Date((0,M.mX)(n,"beginPosition")||(0,M.mX)(n,"BeginPosition")),end:new Date((0,M.mX)(n,"endPosition")||(0,M.mX)(n,"EndPosition"))},function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!e)return{resolution:null,units:null};let t=e.toUpperCase();const n=["Years","Months","Days","Hours","Minutes","Seconds"];let i,o,s;return t.includes("PT")?(t=t.slice(2),s=["H","M","S"].findIndex(e=>t.includes(e)),i=n[3+s],o=parseFloat(t.slice(0,-1))):(t=t.slice(1),s=["Y","M","D"].findIndex(e=>t.includes(e)),s>-1&&(i=n[s]),o=parseFloat(t.slice(0,-1))),{resolution:o,units:i}}((0,M.mX)(n,"timeResolution")||(0,M.mX)(n,"TimeResolution"))):null}function Y(e){const t=(0,M.V6)(e,"spatialDomain"),n=(0,M.V6)(t,"Envelope")||(0,M.V6)(t,"EnvelopeWithTimePeriod"),i=n.getAttribute("srsName").split(":"),o=i[i.length-1],s=(0,M.IC)(n,"pos"),a=(0,M.pN)(s[0]),r=(0,M.pN)(s[1]),l=parseInt(o,10),c=isNaN(l)?null:{wkid:l},u=new T.A({xmin:a[0],ymin:a[1],xmax:r[0],ymax:r[1],spatialReference:c}),d=(0,M.V6)(t,"RectifiedGrid"),p=(0,M.mX)(d,"low").split(" "),m=(0,M.mX)(d,"high").split(" "),f=parseInt(m[0],10)-parseInt(p[0],10)+1,v=parseInt(m[1],10)-parseInt(p[1],10)+1,g=(0,M.pN)(t,"origin/pos"),h=(0,M.IC)(t,"offsetVector"),y={envelope:u,columns:f,rows:v,offset:{x:parseFloat((0,M.mX)(h[0]).split(" ")[0]),y:parseFloat((0,M.mX)(h[1]).split(" ")[1])},origin:{x:g[0],y:g[1]}},b=(0,M.V6)(e,"temporalDomain")||(0,M.V6)(e,"TemporalDomain");return{spatialDomain:y,temporalDomain:b?$(b):null}}function Q(e){const t={version:"1.0"};let n,i=[];for(let f=0;f<e.childNodes.length;f++){const o=e.childNodes[f];if(1===o.nodeType)if((0,M.g7)(o,"description"))t.description=(0,M.mX)(o);else if((0,M.g7)(o,"name"))t.name=(0,M.mX)(o);else if((0,M.g7)(o,"label"))t.label=(0,M.mX)(o);else if((0,M.g7)(o,"supportedFormats"))t.supportedFormats=(0,M.Dy)(o,"formats");else if((0,M.g7)(o,"supportedCRSs"))t.supportedCRSs=B(o);else if((0,M.g7)(o,"supportedInterpolations"))t.supportedInterpolations=j(o,"1.0.0");else if((0,M.g7)(o,"lonLatEnvelope"))t.lonLatEnvelope=q(o);else if((0,M.g7)(o,"rangeSet")){const e=H(o);t.rangeSet=e.rangeSet,i=e.bandNames;const s=e.rangeSet[0].nullValues;(null===s||void 0===s?void 0:s.length)&&(n=z(s))}else(0,M.g7)(o,"domainSet")&&(t.domainSet=Y(o))}const o=W(t.supportedInterpolations),{name:s,description:a,label:r,lonLatEnvelope:l,supportedFormats:c}=t,{spatialDomain:u}=t.domainSet,d={x:Math.abs(u.offset.x),y:Math.abs(u.offset.y)},p=function(e){if(!e.temporalDomain)return null;const{begin:t,end:n,values:i,units:o,resolution:s}=e.temporalDomain,a={variables:[{name:"default",description:"",dimensions:[{name:"StdTime",description:"",unit:"ISO8601",values:null===i||void 0===i?void 0:i.map(e=>e.getTime()),hasRegularIntervals:!i,interval:s,intervalUnit:o,extent:[t.getTime(),n.getTime()]}]}]};return G(a),a}(t.domainSet),m=new k.A({width:u.columns,height:u.rows,pixelSize:d,pixelType:"unknown",extent:u.envelope,spatialReference:u.envelope.spatialReference,bandCount:i.length||1,noDataValue:n,multidimensionalInfo:p});return{id:s,title:t.name,description:a||r,lonLatEnvelope:l,rasterInfo:m,bandNames:i,supportedFormats:c,supportedInterpolations:o,coverageDescription:t,version:"1.0.0",useEPSGAxis:!1}}function J(e,t){const n=[],i=(0,M.IC)(e,"Field");let o,s=[];for(let a=0;a<i.length;a++){const e=(0,M.mX)(i[a],"Identifier"),r=(0,M.mX)(i[a],"Description"),l=(0,M.mX)(i[a],"Definition"),c=(0,M.mX)(i[a],"Abstract"),u=(0,M.mX)(i[a],"Title"),d=Z(i[a],"NullValue"),p=(0,M.V6)(i[a],"AllowedValues"),m=p?U(p):null,f=j(i[a],"1.1.0"),v=[],g=(0,M.IC)(i[a],"Axis");for(let n=0;n<g.length;n++){const e=g[n].getAttribute("identifier"),i=(0,M.mX)(g[n],"UOM"),a=(0,M.mX)(g[n],"DataType"),r=(0,M.Dy)(g[n],"Key");t&&!e.toLowerCase().includes("band")||(s=r,o=d),v.push({identifier:e,uom:i,dataType:a,values:r,bandNoDataValues:o})}n.push({identifier:e,description:r,definition:l,abstract:c,title:u,supportedInterpolations:f,axis:v,nullValues:d,statistics:m})}return{rangeSet:n,bandNames:s,bandNoDataValues:o,statistics:n[0].statistics}}function K(e){var t;const n=(0,M.V6)(e,"SpatialDomain"),i=(0,M.V6)(n,"GridCRS"),o=(0,M.mX)(i,"GridBaseCRS"),s=(0,M.mX)(i,"GridOrigin"),a=null!==(t=null===s||void 0===s?void 0:s.split(" ").map(e=>parseFloat(e)))&&void 0!==t?t:[0,0],r=(0,M.pN)(i,"GridOffsets"),l=(0,M.IC)(n,"BoundingBox");let c,u,d,p;for(let b=0;b<l.length;b++){var m;const e=null===(m=l[b].getAttribute("crs"))||void 0===m?void 0:m.toLowerCase();if(null!=e)if(e.includes("imagecrs")){const e=(0,M.pN)(l[b],"LowerCorner"),t=(0,M.pN)(l[b],"UpperCorner");c=t[0]-e[0]+1,u=t[1]-e[1]+1}else if(e.indexOf("epsg")>0){const t=e.split(":");d=parseInt(t[t.length-1],10);const n=(0,M.pN)(l[b],"LowerCorner"),i=(0,M.pN)(l[b],"UpperCorner");p=new T.A({xmin:n[0],ymin:n[1],xmax:i[0],ymax:i[1],spatialReference:{wkid:d}})}}const f=c>u,v=p.xmax-p.xmin>p.ymax-p.ymin;let g=!1;(0,L.m)(d)&&(f===v?g=!1:(g=!0,p=new T.A({xmin:p.ymin,ymin:p.xmin,xmax:p.ymax,ymax:p.xmax,spatialReference:{wkid:d}})));const h={columns:c,rows:u,origin:{x:a[0],y:a[1]},offset:{x:r[0],y:r[r.length-1]},gridBaseCRS:o,envelope:p,useEPSGAxis:g},y=(0,M.V6)(e,"temporalDomain")||(0,M.V6)(e,"TemporalDomain");return{spatialDomain:h,temporalDomain:y?$(y):null}}function ee(e,t){var n;const i=[],o=[],s={supportedFormats:i,supportedCRSs:o,version:"1.1"};let a,r,l=[];for(let b=0;b<e.childNodes.length;b++){const t=e.childNodes[b];if(1!==t.nodeType)continue;const n=(0,M.vv)(t).toLowerCase();switch(n){case"title":case"abstract":case"identifier":s[n]=(0,M.mX)(t);break;case"supportedformat":{const e=(0,M.mX)(t);i.includes(e)||i.push(e)}break;case"supportedcrs":{const e=(0,M.mX)(t);o.includes(e)||o.push(e)}break;case"range":{var c;const e=J(t,!(null===(c=s.domain)||void 0===c||!c.temporalDomain));s.range=e.rangeSet,l=e.bandNames;const{bandNoDataValues:n}=e;null!==n&&void 0!==n&&n.length&&(a=z(n)),r=e.statistics}break;case"domain":s.domain=K(t)}}const u=W(s.range[0].supportedInterpolations),{identifier:d,abstract:p,title:m,domain:f,range:v}=s,g={x:Math.abs(f.spatialDomain.offset.x),y:Math.abs(f.spatialDomain.offset.y)},h=function(e,t){if(!t.temporalDomain)return null;const n=e.filter(e=>!e.identifier.toLowerCase().includes("field_1")&&!e.axis.some(e=>e.identifier.includes("band"))),i=[];if(n.length&&n.forEach(e=>{var t,n;const o=e.axis.map(e=>{const t=e.values.map(t=>"ISO8601"===e.uom?(t=t.trim()).toLowerCase().includes("z")?new Date(t).getTime():new Date(t+"Z").getTime():parseFloat(t.trim())),n=[Math.min.apply(null,t),Math.max.apply(null,t)];return{name:e.identifier.trim(),description:"",field:e.identifier.trim(),unit:e.uom?e.uom.trim():"",hasRegularIntervals:!1,values:t,extent:n}});i.push({name:e.identifier.trim(),description:null!==(t=null===(n=e.description)||void 0===n?void 0:n.trim())&&void 0!==t?t:"",unit:"",dimensions:o,statistics:e.statistics})}),t.temporalDomain){const{begin:e,end:n,values:o,units:s,resolution:a}=t.temporalDomain;i.some(e=>e.dimensions.some(e=>"stdtime"===e.name.toLowerCase()))||i.forEach(t=>{t.dimensions.push({name:"StdTime",description:"",unit:"ISO8601",values:null===o||void 0===o?void 0:o.map(e=>e.getTime()),hasRegularIntervals:!o,interval:a,intervalUnit:s,extent:[e.getTime(),n.getTime()]})})}if(i.length){const e={variables:i};return G(e),e}return null}(v,f);h&&(a=v[0].nullValues,1===(null===(n=a)||void 0===n?void 0:n.length)&&(a=a[0]));const y=new k.A({width:f.spatialDomain.columns,height:f.spatialDomain.rows,pixelSize:g,pixelType:"unknown",extent:f.spatialDomain.envelope,spatialReference:f.spatialDomain.envelope.spatialReference,bandCount:l.length||1,noDataValue:a,statistics:r,multidimensionalInfo:h});return{id:d,title:s.title,description:p||m,bandNames:l,rasterInfo:y,supportedFormats:i,supportedInterpolations:u,coverageDescription:s,version:t,useEPSGAxis:f.spatialDomain.useEPSGAxis}}function te(e){const t=(0,M.V6)(e,"Envelope")||(0,M.V6)(e,"EnvelopeWithTimePeriod"),n=t.getAttribute("srsName"),i=n.slice(n.lastIndexOf("/")+1),o=t.getAttribute("axisLabels").split(" ").map(e=>e.trim()).filter(e=>""!==e.trim()),s=(0,M.pN)(t,"lowerCorner"),a=(0,M.pN)(t,"upperCorner"),r=!["y","lat","latitude","north","nor","n","b"].includes(o[0].toLowerCase());let l;const c=parseInt(i,10),u=isNaN(c)?null:{wkid:c};l=new T.A(r?{xmin:s[0],ymin:s[1],xmax:a[0],ymax:a[1],spatialReference:u}:{xmin:s[1],ymin:s[0],xmax:a[1],ymax:a[0],spatialReference:u});const d={mins:s,maxs:a},p=t.getAttribute("uomLabels").trim().split(" ");let m,f;if((0,M.g7)(t,"EnvelopeWithTimePeriod")){m=new Date((0,M.mX)(e,"beginPosition")||(0,M.mX)(e,"BeginPosition")),f=new Date((0,M.mX)(e,"endPosition")||(0,M.mX)(e,"EndPosition"));const t=null===p||void 0===p?void 0:p.findIndex(e=>"oledatetime"===(null===e||void 0===e?void 0:e.toLowerCase()));t>-1&&(p[t]="ISO8601")}return{envelope:l,axisLabels:o,uomLabels:p.length?p:null,envelopeAllDims:d,beginPosition:m,endPosition:f,isEastFirst:r}}function ne(e,t){const n=[],i=(0,M.IC)(e,"DataRecord"),o=[];let s,a=[];for(let c=0;c<i.length;c++){const e=(0,M.IC)(i[c],"field"),u=[];for(let n=0;n<e.length;n++){var r,l;const i=e[n].getAttribute("name"),c=(0,M.mX)(e[n],"description")||"",d=(null===(r=(0,M.V6)(e[n],"uom"))||void 0===r?void 0:r.getAttribute("code"))||"",p=(0,M.pN)(e[n],"interval"),m=null===(l=Z(e[n],"nilValue"))||void 0===l?void 0:l[0];t&&!i.toLowerCase().includes("band")||(o.push(i),null!==p&&void 0!==p&&p.length&&(s=s||[],s.push({min:p[0],max:p[1],avg:-1,stddev:-1})),a.push(m)),u.push({name:i,description:c,uom:d,allowedValues:p,nilValue:m})}n.push(u)}return a.some(e=>null!=e)||(a=null),{rangeType:n,bandNames:o,bandStats:s,bandNoDataValues:a}}function ie(e){let t=1,n="";const i=.01;return Math.abs(e-1/24)<1/24*i?n="Hours":Math.abs(e-1)<1*i?n="Days":e<1?(t=Math.round(24*e),n="Hours"):e>28-i&&e<31+i||Math.round(e/30)<12?n="Months":e>365-i&&e<366+i&&(n="Years"),{interval:t,intervalUnit:n}}function oe(e,t){const n=(0,M.V6)(e,"RectifiedGrid"),i=(0,M.pN)(n,"low"),o=(0,M.pN)(n,"high"),s=[];for(let f=0;f<i.length;f++)s.push(o[f]-i[f]+1);const a=(0,M.mX)(n,"axisLabels").split(" "),r=(0,M.pN)(n,"origin/pos"),l=(0,M.IC)(n,"offsetVector"),c=[];for(let f=0;f<l.length;f++){const e=(0,M.pN)(l[f]),t=e.findIndex(e=>0!==e);c[t]=e[t]}let u=!1;null!==t&&void 0!==t&&t.length&&null!==a&&void 0!==a&&a.length&&(u=[...t].sort((e,t)=>e<t?-1:1).join(",")===[...a].sort((e,t)=>e<t?-1:1).join(","));let d,p,m;return["y","lat","latitude","north","nor","n","b"].includes((u?a:t)[0].toLowerCase())?(d=s[1],p=s[0],m={y:Math.abs(c[0]),x:Math.abs(c[1])}):(d=s[0],p=s[1],m={x:Math.abs(c[0]),y:Math.abs(c[1])}),{columns:d,rows:p,origin:r,offset:c,resolution:m,gridSamples:s,axisLabels:a,hasSameAxisLabelsAsBoundedBy:u}}function se(e){const t=(0,M.V6)(e,"EarthObservation");if(!t)return null;const n=(0,M.V6)(t,"phenomenonTime"),i=n?$(n):null,o=(0,M.V6)(t,"phenomenonTime"),s=o?$(o):null,a=(0,M.mX)(t,"featureOfInterest/Footprint/multiExtentOf/MultiSurface/surfaceMembers/Polygon/exterior/LinearRing/posList");let r=null;if(a){const e=a.split(" ").map(e=>e.trim()).filter(e=>null!=e&&""!==e).map(Number);if(e.length){const t=[];for(let n=0;n<e.length/2;n+=2)t.push(e[n],e[n+1]);r=new _.A({rings:[[t]]})}}return{observation:{phenomenonTime:i,resultTime:s,footprint:r,identifier:(0,M.mX)(e,"metaDataProperty/EarthObservationMetaData/identifier"),acquisitionType:(0,M.mX)(e,"metaDataProperty/EarthObservationMetaData/acquisitionType"),status:(0,M.mX)(e,"metaDataProperty/EarthObservationMetaData/status")}}}function ae(e){const t={version:"2.0"};let n,i,o=[];for(let f=0;f<e.childNodes.length;f++){var s;const l=e.childNodes[f];if(1===l.nodeType)if((0,M.g7)(l,"coverageId"))t.coverageId=(0,M.mX)(l);else if((0,M.g7)(l,"ServiceParameters"))t.serviceParameters={supportedFormats:(0,M.Dy)(l,"nativeFormat")};else if((0,M.g7)(l,"boundedBy"))t.boundedBy=te(l);else if((0,M.g7)(l,"rangeType")){var a,r;const e=ne(l,(null===(a=t.boundedBy)||void 0===a?void 0:a.axisLabels.length)>2||(null===(r=t.domainSet)||void 0===r?void 0:r.axisLabels.length)>2);t.rangeType=e.rangeType,o=e.bandNames,n=e.bandStats;const{bandNoDataValues:s}=e;(null===s||void 0===s?void 0:s.length)&&(i=z(s))}else if((0,M.g7)(l,"domainSet"))t.domainSet=oe(l,null===(s=t.boundedBy)||void 0===s?void 0:s.axisLabels);else if((0,M.g7)(l,"metadata")){const e=(0,M.V6)(l,"EOMetadata");t.eoMetadata=e?se(e):null}}const{coverageId:l,boundedBy:c,domainSet:u,rangeType:d,serviceParameters:p}=t,m=function(e,t,n){if(n.axisLabels.length<=2)return null;const i=[];for(let r=0;r<e.length;r++){const t=e[r];for(let e=0;e<t.length;e++)t[e].name.toLowerCase().includes("band")||i.push(t[e])}const o=[];if(i.length){const e=[];for(let i=2;i<n.axisLabels.length;i++){var s,a;const o=null!==(s=null===(a=t.uomLabels)||void 0===a||null===(a=a[i])||void 0===a?void 0:a.trim())&&void 0!==s?s:"",r=n.axisLabels[i].toLowerCase().includes("time")||"iso8601"===o.toLowerCase()||"oledatetime"===o.toLowerCase();let l,c;if(r){const e=ie(n.offset[i]);l=e.interval,c=e.intervalUnit}else l=n.offset[i],c=o;const u=[];r?(u.push((0,F.$E)(t.envelopeAllDims.mins[i])),u.push((0,F.$E)(t.envelopeAllDims.maxs[i]))):(u.push(t.envelopeAllDims.mins[i]),u.push(t.envelopeAllDims.maxs[i])),e.push({name:n.axisLabels[i].trim(),description:n.axisLabels[i].trim(),unit:r?"ISO8601":o,hasRegularIntervals:!0,extent:u,interval:l,intervalUnit:c})}if(i.forEach(t=>{var n,i;const{allowedValues:s}=t,a=2===(null===s||void 0===s?void 0:s.length)?[{min:s[0],max:s[1],avg:-1,stddev:-1}]:null;o.push({name:t.name.trim(),description:null!==(n=null===(i=t.description)||void 0===i?void 0:i.trim())&&void 0!==n?n:"",unit:t.uom.trim(),statistics:a,dimensions:[...e]})}),o.length){const e={variables:o};return G(e),e}}return null}(d,c,u);return!n&&m&&(n=null===m||void 0===m?void 0:m.variables[0].statistics),null!=m&&(i=d[0][0].nilValue),{id:l,title:l,description:l,bandNames:o,rasterInfo:new k.A({width:u.columns,height:u.rows,pixelSize:u.resolution,pixelType:"unknown",extent:c.envelope,spatialReference:c.envelope.spatialReference,bandCount:o.length||1,statistics:n,noDataValue:i,multidimensionalInfo:m}),supportedFormats:p.supportedFormats,coverageDescription:t,version:"2.0.1",useEPSGAxis:!1}}async function re(e,t){const{version:n,customParameters:o,signal:s}=null!==t&&void 0!==t?t:{},a=null!==n&&void 0!==n&&n.startsWith("1.0")?"version":"acceptVersions",l=(0,i.A)({service:"WCS",request:"GetCapabilities",[a]:n},o);try{let{data:n}=await(0,V.A)(e,{query:l,responseType:"xml",signal:s});return null!==t&&void 0!==t&&t.version||function(e){let t=null;t="string"==typeof e?(new DOMParser).parseFromString(e,"text/xml"):e;const n=t.documentElement.getAttribute("version"),i=null===n||void 0===n?void 0:n.slice(0,3);return null!=i&&i<"2.1"}(n)||(l[a]="2.0.1",({data:n}=await(0,V.A)(e,{query:l,responseType:"xml",signal:s}))),X(n)}catch(R){if(!(0,c.zf)(R))throw new r.A("wcslayer:open","wcs capabilities is not valid or supported");throw R}}async function le(e,t){const{coverageIds:n,version:o,customParameters:s,signal:a}=t,l=o.slice(0,3),u="1.0"===l?"coverage":"1.1"===l?"identifiers":"coverageId",d=(0,i.A)({service:"WCS",request:"DescribeCoverage",version:o,[u]:n.join(",")},s);try{const{data:t}=await(0,V.A)(e,{query:d,responseType:"xml",signal:a});return function(e,t){let n=null;if(n="string"==typeof e?(new DOMParser).parseFromString(e,"text/xml"):e,"1.0.0"===t)return(0,M.IC)(n,"CoverageOffering").map(e=>Q(e));const i=(0,M.IC)(n,"CoverageDescription");return"1.1.0"===t||"1.1.1"===t||"1.1.2"===t?i.map(e=>ee(e,t)):i.map(e=>ae(e))}(t,o)}catch(O){if(!(0,c.zf)(O))throw new r.A("wcslayer:open","wcs coverage description is not valid or supported");throw O}}var ce=n(15359),ue=n(10410);function de(e){const t=function(e){var t,n;const i=null===(t=e.getHeader)||void 0===t||null===(t=t.call(e,"Content-Type"))||void 0===t?void 0:t.split(";");if(!i)return null;if(!(null!==(n=i[0].trim())&&void 0!==n?n:"").startsWith("multipart/"))return null;const o={boundary:"",start:"",type:""};for(let s=1;s<i.length;s++){const e=i[s].indexOf("=");if(e>0){const t=i[s].slice(0,e).trim(),n=i[s].slice(e+1).trim();o[t]=n.startsWith('"')?n.slice(1,-1):n}}return o}(e);return t?{isMultipart:!0,data:t.boundary?pe(e.data,t,0):null}:{isMultipart:!1,data:null}}function pe(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i="--"+t.boundary,o=[];for(let g=0;g<i.length;g++)o.push(i.charCodeAt(g));const s=[],a="\n--"+t.boundary+"--";for(let g=0;g<a.length;g++)s.push(a.charCodeAt(g));const r=[10],l=[13,10],c=[],u=o.length,d=new Uint8Array(e,n),p=d.length-u;let m=0,f=0;for(let g=0;g<p;g++){for(f=0;f<u&&d[g+f]===o[f];f++);if(f!==u)continue;let e=!1;if(m){const n=me(d.subarray(m,g),t);c.push(n),e=!!n.isValidImage}if(g+=u-1,d[g+1]===r[0]?g+=1:d[g+1]===l[0]&&d[g+2]===l[1]&&(g+=2),m=g+1,e)break}const v=s.length;for(let g=d.length-v-10;g<d.length-v;g++){for(f=0;f<v&&d[g+f]===s[f];f++);if(f===v){c.push(me(d.subarray(m,g),t));break}}return c}function me(e,t){const n=String.fromCharCode.apply(null,e.subarray(0,Math.min(300,e.length))).split("\n"),i=Math.min(n.length,7),o={contentDisposition:"inline"};let s=0;for(let r=0;r<i;r++)if(n[r].length<4)s=s+n[r].length+1;else if("content"===n[r].slice(0,7).toLowerCase()){s=s+n[r].length+1;const e=n[r].indexOf(":");if(-1===e)continue;const t=n[r].slice(0,e).trim(),i=n[r].slice(e+1).trim();switch(t.toLowerCase()){case"content-type":o.contentType=i;break;case"content-description":o.contentDescription=i;break;case"content-transfer-encoding":o.contentTransferEncoding=i;break;case"content-id":o.contentID=i;break;case"content-disposition":o.contentDisposition=i;break;case"content-location":o.contentLocation=i}}else{var a;if(o.contentDisposition.toLowerCase().includes("inline")&&n[r].length>=4&&(null===(a=o.contentType)||void 0===a?void 0:a.toLowerCase().indexOf("image"))>-1){let t=!0,n=e.subarray(s,e.length);if(o.contentType.toLowerCase().indexOf("tif")>0){if("base64"===o.contentTransferEncoding){let e="";const t=n;for(let n=0;n<t.length;n+=65535){const i=t.subarray(n,n+65535>t.length-1?t.length-1:n+65535);e+=String.fromCharCode.apply(null,i)}const i=atob(e);n=new Uint8Array(i.length);for(let o=0;o<n.length;o++)n[o]=i.charCodeAt(o)}t=73===n[0]&&73===n[1]||77===n[0]&&77===n[1]}if(t){let t=n.buffer;"base64"!==o.contentTransferEncoding&&(t=new ArrayBuffer(e.length-s),n=new Uint8Array(t),n.set(e.subarray(s,e.length))),o.contentData=t,o.isValidImage=!0}break}if((""===t.start||o.contentID===t.start)&&o.contentType){if(o.contentType.includes("text")||o.contentType.includes("xml")){o.contentData=String.fromCharCode.apply(null,e.subarray(s,e.length));break}o.contentData=e.subarray(s,e.length)}}return o}var fe=n(59648),ve=n(52494);const ge=["nearest neighbor","bilinear","bicubic"],he=["nearest","linear","cubic"],ye="response is not a supported multipart/related mediaType with inline tiff,  switching to compatibility mode",be=new Set(["1.0.0","1.1.0","1.1.1","1.1.2","2.0.1"]);let we=class extends ue.A{constructor(){super(...arguments),this.datasetFormat="WCSServer",this.tileType="Raster"}get rasterId(){return"".concat(this.url,"-").concat(this.coverageId,"-").concat(this.version)}async fetchRawTile(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(this.isBlockOutside(e,t,n))return null;const{nativePixelSize:o,spatialReference:s}=this.rasterInfo,a=2**e,l=o.x*a,c=o.y*a,{blockWidth:u,blockHeight:d}=this.getBlockWidthHeight(e),{origin:p}=this.rasterInfo.storageInfo.tileInfo,m=this.getTileExtent({x:l,y:c},t,n,p,s,[u,d]),f=this.rasterInfo.extent,v=m.xmax>f.xmax,g=m.ymin<f.ymin,h=v||g;let y=m,b=u,w=d;if(h&&(y=m.clone().intersection(f),null!=y&&(v&&(b=Math.floor((y.xmax-y.xmin)/l),y.xmax=y.xmin+l*b),g&&(w=Math.floor((y.ymax-y.ymin)/c),y.ymin=y.ymax-c*w))),null==y||b<=1||w<=1)return null;const x=await this._getCoverage(y,b,w,a,i);if(!x)return null;const{coverageDescription:C}=this.coverageInfo,{noDataValue:I,multidimensionalInfo:S}=this.rasterInfo,{multidimensionalDefinition:A}=i;let D;if(null!=S&&null!=A&&A.length){const e=A[0].variableName;if("2.0"===C.version){const t=C.rangeType[0].find(t=>t.name===e);D=null===t||void 0===t?void 0:t.nilValue}else if("1.1"===C.version){const t=C.range.find(t=>t.identifier===e);D=null===t||void 0===t?void 0:t.nullValues}}const T=null!==D&&void 0!==D?D:I,L=await this.decodePixelBlock(x,{width:b,height:w,planes:null,pixelType:null,tiffNoDataValue:Array.isArray(T)?T[0]:T,matchAllNoData:!0});if(null==L)return null;if(L&&(L.width!==b||L.height!==w))throw new r.A("wcsraster-fetch","the response has unexpected dimension width: ".concat(L.width,", height: {pixelBlock.height}"));return h?(0,ve.$Q)(L,{x:0,y:0},{width:d,height:d}):L}async _open(e){var t,n;const{customFetchParameters:i}=this.ioConfig,o=null===e||void 0===e?void 0:e.signal,s=await re(this.url,{version:null!==(t=null===i||void 0===i?void 0:i.version)&&void 0!==t?t:this.version,customParameters:i,signal:o});if(this.capabilities=s,!this.version){let e=s.version.slice(0,3);"2.0"===e||"1.1"===e||"1.0"===e?this.version=s.version:(e=s.supportedVersions.find(e=>"2.0.1"===e)||s.supportedVersions.find(e=>"2.0"===e.slice(0,3))||s.supportedVersions.find(e=>"1.1"===e.slice(0,3))||s.supportedVersions.find(e=>"1.0"===e.slice(0,3))||"1.0.0",this.version=e)}const{version:a}=this;if(!be.has(a))throw new r.A("wcsraster-open","unsupported WCS version ".concat(a));const{gridCoverages:l}=s;if(!l.length)throw new r.A("wcsraster-open","cannot find rectified grid coverages");null!==(n=this.coverageId)&&void 0!==n||(this.coverageId=l[0].id);const{coverageId:c}=this,u=l.find(e=>e.id===c);if(null==u)throw new r.A("wcsraster-open","the coverageId ".concat(c," does not exist in capabilities"));const d=await le(this.url,{coverageIds:[c],version:a,customParameters:i,signal:o});if(this.coverageInfo=d[0],"2.0"===a.slice(0,3)){const{coverageInfo:e}=this;e.lonLatEnvelope=u.lonLatEnvelope,e.supportedInterpolations=W(s.supportedInterpolations),this._patchDimensionValues201(c,o)}this.datasetName=this.coverageInfo.title;const{rasterInfo:p}=this.coverageInfo;if(this.createRemoteDatasetStorageInfo(p,512,512),this._set("rasterInfo",p),null==p.spatialReference)throw new r.A("wcsraster-open","coverage without spatial reference is not supported: ".concat(c));const{pixelType:m,bandCount:f}=await this._getPixelTypeAndBandCount(o);p.pixelType=m,1===p.bandCount&&f>1&&(p.bandCount=f),this.updateTileInfo()}async _patchDimensionValues201(e,t){var n;const{coverageInfo:o}=this,s=null===(n=o.rasterInfo.multidimensionalInfo)||void 0===n?void 0:n.variables,a=be.has("1.1.2")?"1.1.2":be.has("1.1.1")?"1.1.1":be.has("1.1.0")?"1.1.0":null,{customFetchParameters:r}=this.ioConfig;if(s&&a)try{var l;const n=this.url.includes("/ImageServer/"),o=e.length>8&&e.startsWith("Coverage")&&n?e.slice(8):e,p=await le(this.url,{coverageIds:[null!==o&&void 0!==o?o:e],version:a,customParameters:r,signal:t}).catch(()=>{if(o)return le(this.url,{coverageIds:[e],version:a,customParameters:r,signal:t})}),m=null===p||void 0===p||null===(l=p[0].rasterInfo.multidimensionalInfo)||void 0===l?void 0:l.variables;if(m)for(const e of s){var c;const t=m.find(t=>{let{name:n}=t;return n===e.name});if(null!==t&&void 0!==t&&null!==(c=t.dimensions)&&void 0!==c&&c.length)for(let o=e.dimensions.length-1;o>=0;o--){var u,d;const s=e.dimensions[o],a=t.dimensions.find(e=>{let{name:t}=e;return t===s.name});a?a.values&&(null===(u=a.extent)||void 0===u?void 0:u.join(","))===(null===(d=s.extent)||void 0===d?void 0:d.join(","))&&(e.dimensions[o]=(0,i.A)((0,i.A)({},s),{},{values:a.values})):n&&e.dimensions.splice(o,1)}}}catch(p){}}async _getPixelTypeAndBandCount(e){var t;const{pixelSize:n,extent:i,multidimensionalInfo:o}=this.rasterInfo,s=i.center,a=new T.A({xmin:s.x-n.x,xmax:s.x+n.x,ymin:s.y-n.y,ymax:s.y+n.y,spatialReference:i.spatialReference});let l=[];if(null!=o){const e=o.variables[0];l=[],e.dimensions.forEach(t=>{var n,i;l.push(new ce.A({variableName:e.name,dimensionName:t.name,values:t.hasRegularIntervals?null===(n=t.extent)||void 0===n?void 0:n[0]:null===(i=t.values)||void 0===i?void 0:i[0],isSlice:!0}))})}const{coverageDescription:c}=this.coverageInfo,u={interpolation:"nearest",multidimensionalDefinition:l,signal:e},{version:d}=c,{ioConfig:m}=this,f="2.0"===d&&null==m.allowAnyMediaType||"1.1"===d&&null==m.use2GridOffsets;let v;try{v=await this._getCoverage(a,2,2,1,u,!0)}catch(H){if(!f)throw H;if("1.1"===d){var g;if(null===(g=H.details)||void 0===g||!g.isResolutionMismatch)throw H;m.use2GridOffsets=!0}}if(!v&&f&&("2.0"===d&&(m.allowAnyMediaType=!0),v=await this._getCoverage(a,2,2,1,u),v&&p.A.getLogger(this).warn("wcsraster:getcoverage",ye)),!v)throw new r.A("wcsraster-open","unable to determine pixel type");const h=await this.decodePixelBlock(v,{width:2,height:2,planes:null,pixelType:null});if(null==h)throw new r.A("wcsraster-open","unable to determine pixel type");return{pixelType:h.pixelType,bandCount:null!==(t=h.getPlaneCount())&&void 0!==t?t:0}}async _getCoverage(e,t,n,i,o){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const{coverageDescription:a}=this.coverageInfo,{version:l}=a,c="2.0"===l?this._getCoverage201Parameters(e,t,n,i,o,a):"1.1"===l?this._getCoverage110Parameters(e,t,n,o,a):this._getCoverage100Parameters(e,t,n,o),u="2.0"===l?await this.request(this._constructWCS201Url(c),{signal:o.signal,responseType:"array-buffer"}):await this.request(this.url,{query:c,signal:o.signal,responseType:"array-buffer"});if("1.0"===l)return u.data;if("2.0"===l&&!1!==this.ioConfig.allowAnyMediaType&&"tiff"===(0,fe.g)(u.data))return s&&(this.ioConfig.allowAnyMediaType=!0,p.A.getLogger(this).warn("wcsraster:getcoverage",ye)),u.data;const d=de(u);if(d.isMultipart&&d.data){const e=d.data.find(e=>e.isValidImage);return s&&"base64"===(null===e||void 0===e?void 0:e.contentTransferEncoding)&&p.A.getLogger(this).warn("wcsraster:getcoverage","response is base64 encoded which may impact layer display performance"),null===e||void 0===e?void 0:e.contentData}const m=new Uint8Array(u.data,0,Math.min(u.data.byteLength,2e3)),f=String.fromCharCode.apply(null,m).toLowerCase().includes("exception"),v=f&&String.fromCharCode.apply(null,m).includes("A non-zero RESX/RESY or WIDTH/HEIGHT is required but neither was provided");if(f)throw new r.A("wcsraster:getcoverage","server returns an exception",{isResolutionMismatch:v});throw new r.A("wcsraster:getcoverage","response is not a supported multipart mediaType with inline tiff")}_getInterpolationIndex(e){var t;return e&&null!==(t=this.coverageInfo.supportedInterpolations)&&void 0!==t&&t.includes(e)?"nearest"===e?0:"bilinear"===e?1:"cubic"===e?2:0:0}_getCoverage100Parameters(e,t,n,i){const o="".concat(e.xmin,",").concat(e.ymin,",").concat(e.xmax,",").concat(e.ymax),s=e.spatialReference.wkid,a=(this.coverageInfo.supportedFormats||[]).find(e=>e.toLowerCase().includes("tiff"))||"GEOTIFF",{bandIds:r,interpolation:l}=i,c=this._getInterpolationIndex(l),u=r?r.map(e=>this.coverageInfo.bandNames[e]):null,d=ge[c],{multidimensionalDefinition:p}=i;let m;if(null!=p&&null!=this.rasterInfo.multidimensionalInfo){const e=p.find(e=>"StdTime"===e.dimensionName);let t=null===e||void 0===e?void 0:e.values;t&&t.length>0&&(Array.isArray(t[0])&&(t=t[0]),m=t.map(e=>xe(e)).join(","))}return{service:"WCS",request:"GetCoverage",version:this.version,coverage:this.coverageId,format:a,crs:"EPSG:".concat(s),bbox:o,width:t,height:n,time:m,interpolation:d,band:null===u||void 0===u?void 0:u.join(",")}}_getCoverage110Parameters(e,t,n,i,o){var s;const{multidimensionalDefinition:a,bandIds:r,interpolation:l}=i,c=e.spatialReference.wkid,u="urn:ogc:def:crs:EPSG::".concat(c),d=(this.coverageInfo.supportedFormats||[]).find(e=>e.toLowerCase().includes("tiff"))||"image/tiff",p=this._getInterpolationIndex(l),m=he[p],f=null==l||0===(null===(s=this.coverageInfo.supportedInterpolations)||void 0===s?void 0:s.indexOf(l)),v=o.domain.spatialDomain,g=v.origin.x<=v.envelope.xmin&&v.origin.y<=v.envelope.ymin,h=e.width/t,y=e.height/n*(g?1:-1),b=g?[e.xmin,e.ymin]:[e.xmin,e.ymax],w=v.useEPSGAxis&&(0,L.m)(c),x=w?"".concat(b[1],",").concat(b[0]):"".concat(b[0],",").concat(b[1]),C=this.ioConfig.use2GridOffsets,I=w?C?"".concat(y,",").concat(h):"".concat(y,",0,0,").concat(h):C?"".concat(h,",").concat(y):"".concat(h,",0,0,").concat(y),S=h/2,A=e.xmin+S,D=e.xmax-S,T=Math.abs(y)/2,V=e.ymin+T,M=e.ymax-T,N=w?"".concat(V,",").concat(A,",").concat(M,",").concat(D,",").concat(u):"".concat(A,",").concat(V,",").concat(D,",").concat(M,",").concat(u),R=o.range.find(e=>e.axis.some(e=>e.identifier.toLowerCase().includes("band")));let P,E=R&&m&&r?f?"".concat(R.identifier,"[").concat(R.axis[0].identifier,"[").concat(r.join(","),"]]"):"".concat(R.identifier,":").concat(m,"[").concat(R.axis[0].identifier,"[").concat(r.join(","),"]]"):null;if(null!=a&&a.length)for(let L=0;L<a.length;L++){var O,X;let e=a[L].values;const t=null===(O=a[L].dimensionName)||void 0===O?void 0:O.toLowerCase(),n=null===(X=a[L].variableName)||void 0===X?void 0:X.toLowerCase(),i=o.range.find(e=>e.identifier.toLowerCase()===n);if(e.length>0)if(Array.isArray(e[0])&&(e=e[0]),"stdtime"===t)P=e.map(e=>xe(e)).join(",");else if(i){const n=i.axis.find(e=>e.identifier.toLowerCase()===t);n&&(E=f?i.identifier+"["+n.identifier+"["+e.join(",")+"]]":i.identifier+":"+m+"["+n.identifier+"["+e.join(",")+"]]")}L===a.length-1&&i&&!E&&(E=f?i.identifier:i.identifier+":"+m)}return{service:"WCS",request:"GetCoverage",version:this.version,identifier:this.coverageId,format:d,crs:"EPSG:".concat(c),boundingbox:N,gridCS:"urn:ogc:def:cs:OGC:0.0:Grid2dSquareCS",gridType:"urn:ogc:def:method:WCS:1.1:2dGridIn2dCrs",gridOrigin:x,gridOffsets:I,gridBaseCRS:u,timeSequence:P,rangeSubset:E}}_getCoverage201Parameters(e,t,n,i,o,s){const{multidimensionalDefinition:a,interpolation:r}=o,l=this._getInterpolationIndex(r);let c=null;const{supportedInterpolations:u}=this.capabilities;if(null!==u&&void 0!==u&&u.length)switch(l){case 0:c=u.find(e=>e.toLowerCase().includes("nearest"));break;case 1:c=u.find(e=>e.toLowerCase().includes("linear"));break;case 2:c=u.find(e=>e.toLowerCase().includes("cubic")||e.toLowerCase().includes("quadratic"))}const d=(this.coverageInfo.supportedFormats||[]).find(e=>e.toLowerCase().includes("tiff"))||"image/tiff",{bandNames:p}=this.coverageInfo,{boundedBy:m,domainSet:f,rangeType:v}=s,g=m.isEastFirst?0:1,h=1-g,{axisLabels:y}=m,b=y[g],w=y[h],x="http://www.opengis.net/def/crs/EPSG/0/".concat(e.spatialReference.wkid),C=x,I=[];I.push("".concat(b,"(").concat(e.xmin,",").concat(e.xmax,")")),I.push("".concat(w,"(").concat(e.ymin,",").concat(e.ymax,")"));const S=[];if(y.length>2)for(let N=2;N<y.length;N++){const e=f.origin[N];if(y[N].toLowerCase().includes("time")){var A;let t=e.toString();null!==(A=m.uomLabels)&&void 0!==A&&A[N].toLowerCase().includes("ole")&&(S.push(y[N]),t=xe(e,!0)),I.push(y[N]+",http://www.opengis.net("+t+")")}else I.push(y[N]+",http://www.opengis.net("+e+")")}let D=null;if(null!=a&&a.length){const e=[];v.forEach(t=>t.forEach(t=>e.push(t.name)));const t=[];for(let n=0;n<a.length;n++){const i=y.find(e=>e===a[n].dimensionName),o=e.find(e=>e===a[n].variableName);if(t.includes(o)||t.push(o),i){let e=a[n].values;if(e.length>0){Array.isArray(e[0])&&(e=e[0]);let t="";t=i.toLowerCase().includes("time")?e.map(e=>xe(e)).join(","):e.join(",");const n=I.findIndex(e=>0===e.indexOf(i+",http://www.opengis.net"));-1===n&&I.push(i+",http://www.opengis.net("+t+")"),-1===n||I[n].includes("("+t+")")||I.splice(n,1,i+",http://www.opengis.net("+t+")")}}}t.length&&(D=t.join(","))}else(null===p||void 0===p?void 0:p.length)>=2&&(D=(o.bandIds?o.bandIds.map(e=>p[e]):p).join(","));const T=I.join("&subset="),L=!s.domainSet.hasSameAxisLabelsAsBoundedBy&&!1!==this.ioConfig.allowScaleFactor,V=L?null:"".concat(b,"(").concat(t,"),").concat(w,"(").concat(n,")"),M=L?1/i:null;return{service:"WCS",request:"GetCoverage",version:this.version,coverageId:this.coverageId,rangesubset:D,interpolation:c,scaleSize:V,scaleFactor:M,subset:T,format:d,mediaType:this.ioConfig.allowAnyMediaType?null:"multipart/related",outputcrs:x,subsettingcrs:C}}_constructWCS201Url(e){const t=(0,i.A)((0,i.A)({},this.ioConfig.customFetchParameters),e),n=[];return Object.keys(t).forEach(e=>{const i=t[e];null!=i&&("subset"===e?"string"==typeof i&&i.split("&subset=").forEach(e=>{e&&n.push("subset=".concat(encodeURIComponent(e)))}):n.push("".concat(e,"=").concat(encodeURIComponent(i))))}),"".concat(encodeURI(this.url),"?").concat(n.join("&"))}};function xe(e){return(arguments.length>1&&void 0!==arguments[1]&&arguments[1]?new Date((0,F.$E)(e)):new Date(e)).toISOString()}(0,o._)([(0,d.MZ)({type:String,json:{write:!0}})],we.prototype,"datasetFormat",void 0),(0,o._)([(0,d.MZ)({readOnly:!0})],we.prototype,"tileType",void 0),(0,o._)([(0,d.MZ)({type:String,json:{write:!0}})],we.prototype,"version",void 0),(0,o._)([(0,d.MZ)({type:String,json:{write:!0}})],we.prototype,"coverageId",void 0),(0,o._)([(0,d.MZ)({readOnly:!0})],we.prototype,"rasterId",null),we=(0,o._)([(0,m.$)("esri.layers.support.rasterDatasets.WCSRaster")],we);var Ce=n(30973),Ie=n(61701);const Se=new Set(["milliseconds","seconds","minutes","hours","days","weeks","months","years","decades","centuries"]);let Ae=class extends((0,v.dM)((0,C.j)((0,y.q)((0,b.A)((0,g.d)((0,h.o)((0,w.G)((0,I.e)((0,x.J)((0,l.P)(a.A.ClonableMixin(f.A)))))))))))){constructor(){super(...arguments),this.coverageId=null,this.version=null,this.isReference=null,this.legendEnabled=!0,this.noData=0,this.operationalLayerType="WCS",this.type="wcs",this.popupEnabled=!0,this.popupTemplate=null,this.fields=null,this._debouncedSaveOperations=(0,c.sg)(async(e,t,i)=>{const{save:o,saveAs:s}=await n.e(20964).then(n.bind(n,20964));switch(e){case Ie.X.SAVE:return o(this,t);case Ie.X.SAVE_AS:return s(this,i,t)}})}normalizeCtorArgs(e,t){return"string"==typeof e?(0,i.A)({url:e},t):e}load(e){const t=null!=e?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["WCS"]},e).catch(c.QP).then(()=>this._openRaster(t))),Promise.resolve(this)}get coverageInfo(){return this.raster.coverageInfo}get defaultPopupTemplate(){return this.createPopupTemplate()}get rasterFields(){var e,t;const n=[(0,D.rZ)("Pixel Value")],i=null!==(e=null===(t=this.raster)||void 0===t?void 0:t.rasterInfo)&&void 0!==e?e:this.serviceRasterInfo,o=null===i||void 0===i?void 0:i.multidimensionalInfo;if(o){const e=(0,D.AL)(o);n.push(...e)}return n}createPopupTemplate(e){return(0,Ce.tn)({fields:this.rasterFields,title:this.title},e)}async save(e){return this._debouncedSaveOperations(Ie.X.SAVE,e)}async saveAs(e,t){return this._debouncedSaveOperations(Ie.X.SAVE_AS,t,e)}async _openRaster(e){const t=new we({url:this.url,version:this.version,coverageId:this.coverageId,ioConfig:(0,i.A)((0,i.A)({sampling:"closest"},this.ioConfig),{},{customFetchParameters:this.customParameters})});if(await t.open({signal:e}),!t.rasterInfo)throw t.destroy(),new r.A("wcs-layer:load","cannot load resources on "+this.url);const{rasterInfo:n}=t;null==n.noDataValue&&(n.noDataValue=this.noData),this._set("serviceRasterInfo",n),this._set("spatialReference",n.spatialReference),null==this.title&&this.setAtOrigin("title",t.datasetName,"service"),null==this.coverageId&&this.setAtOrigin("coverageId",t.coverageInfo.id,"service"),null==this.version&&t.version&&this.setAtOrigin("version",t.version,"service"),this.setAtOrigin("tileInfo",t.rasterInfo.storageInfo.tileInfo,"service");const{multidimensionalInfo:o}=n;if(null!=o){const e=o.variables[0].dimensions.find(e=>{let{name:t}=e;return"StdTime"===t});if(e){var s,a,l,c,d,p;let t=null!==(s=null===(a=e.extent)||void 0===a?void 0:a[0])&&void 0!==s?s:e.values[0];Array.isArray(t)&&(t=t[0]);let n=null!==(l=null===(c=e.extent)||void 0===c?void 0:c[1])&&void 0!==l?l:e.values[e.values.length-1];Array.isArray(n)&&(n=n[1]);const i=Se.has(null===(d=e.intervalUnit)||void 0===d?void 0:d.toLowerCase())?null===(p=e.intervalUnit)||void 0===p?void 0:p.toLowerCase():null;this.set("timeInfo",{startField:"StdTime",fullTimeExtent:{start:t,end:n},timeZone:null,interval:i?{value:e.interval,unit:i}:null})}}this.raster=t,this._configDefaultSettings(),this.addHandles((0,u.wB)(()=>this.customParameters,e=>this.raster.ioConfig.customFetchParameters=e))}};(0,o._)([(0,d.MZ)({type:String,nonNullable:!0,json:{name:"wcsInfo.coverageId",write:{isRequired:!0,ignoreOrigin:!0}}})],Ae.prototype,"coverageId",void 0),(0,o._)([(0,d.MZ)()],Ae.prototype,"coverageInfo",null),(0,o._)([(0,d.MZ)({type:["1.0.0","1.1.0","1.1.1","1.1.2","2.0.1"],nonNullable:!0,json:{name:"wcsInfo.version",write:{isRequired:!0,ignoreOrigin:!0}}})],Ae.prototype,"version",void 0),(0,o._)([(0,d.MZ)({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],Ae.prototype,"isReference",void 0),(0,o._)([(0,d.MZ)({json:{read:!0,write:!0}})],Ae.prototype,"blendMode",void 0),(0,o._)([(0,d.MZ)(S.fV)],Ae.prototype,"legendEnabled",void 0),(0,o._)([(0,d.MZ)({type:["show","hide"]})],Ae.prototype,"listMode",void 0),(0,o._)([(0,d.MZ)()],Ae.prototype,"noData",void 0),(0,o._)([(0,d.MZ)({type:["WCS"]})],Ae.prototype,"operationalLayerType",void 0),(0,o._)([(0,d.MZ)()],Ae.prototype,"raster",void 0),(0,o._)([(0,d.MZ)({readOnly:!0})],Ae.prototype,"type",void 0),(0,o._)([(0,d.MZ)(S.M6)],Ae.prototype,"popupEnabled",void 0),(0,o._)([(0,d.MZ)({type:s.A,json:{name:"popupInfo",write:!0}})],Ae.prototype,"popupTemplate",void 0),(0,o._)([(0,d.MZ)({readOnly:!0})],Ae.prototype,"defaultPopupTemplate",null),(0,o._)([(0,d.MZ)({readOnly:!0,type:[A.A]})],Ae.prototype,"fields",void 0),(0,o._)([(0,d.MZ)({readOnly:!0,type:[A.A]})],Ae.prototype,"rasterFields",null),Ae=(0,o._)([(0,m.$)("esri.layers.WCSLayer")],Ae);const De=Ae},65660:(e,t,n)=>{n.d(t,{m:()=>o});const i=[[3819,3819],[3821,3824],[3889,3889],[3906,3906],[4001,4025],[4027,4036],[4039,4047],[4052,4055],[4074,4075],[4080,4081],[4120,4176],[4178,4185],[4188,4216],[4218,4289],[4291,4304],[4306,4319],[4322,4326],[4463,4463],[4470,4470],[4475,4475],[4483,4483],[4490,4490],[4555,4558],[4600,4646],[4657,4765],[4801,4811],[4813,4821],[4823,4824],[4901,4904],[5013,5013],[5132,5132],[5228,5229],[5233,5233],[5246,5246],[5252,5252],[5264,5264],[5324,5340],[5354,5354],[5360,5360],[5365,5365],[5370,5373],[5381,5381],[5393,5393],[5451,5451],[5464,5464],[5467,5467],[5489,5489],[5524,5524],[5527,5527],[5546,5546],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3038,3051],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3150,3151],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3389,3390],[3416,3417],[3833,3841],[3844,3850],[3854,3854],[3873,3885],[3907,3910],[4026,4026],[4037,4038],[4417,4417],[4434,4434],[4491,4554],[4839,4839],[5048,5048],[5105,5130],[5253,5259],[5269,5275],[5343,5349],[5479,5482],[5518,5519],[5520,5520],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]];function o(e){return null!=e&&i.some(t=>{let[n,i]=t;return e>=n&&e<=i})}}}]);
//# sourceMappingURL=29954.7a7eb010.chunk.js.map