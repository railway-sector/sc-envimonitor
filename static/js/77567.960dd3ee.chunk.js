"use strict";(self.webpackChunksc_envimonitor=self.webpackChunksc_envimonitor||[]).push([[77567],{18153:(e,t,n)=>{n.d(t,{$:()=>c,p:()=>l});var i=n(23862),o=n(80794),r=n(9876),a=n(72317);function s(e){let{x:t,y:n,z:o}=e;return(0,i.fA)(t,n,null!==o&&void 0!==o?o:0)}function c(e,t){switch(e.type){case"edge":return e.draped?new o.X({edgeStart:s(e.start),edgeEnd:s(e.end),targetPoint:(0,i.de)(s(e.target)),objectId:e.objectId,getGroundElevation:t}):new r.z({edgeStart:s(e.start),edgeEnd:s(e.end),targetPoint:(0,i.de)(s(e.target)),objectId:e.objectId,isDraped:!1});case"vertex":return new a.C({targetPoint:(0,i.de)(s(e.target)),objectId:e.objectId,isDraped:!1})}}function l(e,t){return null!=e&&"3d"===e.type?(n,i)=>e.elevationProvider.getElevation(n,i,0,t,"ground"):()=>null}},23241:(e,t,n)=>{n.d(t,{_:()=>r});var i=n(20664),o=n(64753);class r extends o.m{constructor(e,t,n){super(t,n),this.point=e}equals(e){return e instanceof r&&(0,i.q)(this.point,e.point)}}},35961:(e,t,n)=>{n.d(t,{n:()=>c});n(81806);var i=n(53521),o=n(87663),r=n(50346),a=n(31633),s=n(59097);function c(){let e=arguments.length>1?arguments[1]:void 0;if(arguments.length>0&&void 0!==arguments[0]&&arguments[0]){const{elevationInfo:t,alignPointsInFeatures:n}=e;return new u(t,n)}return new l}class l{async alignCandidates(e,t,n){return e}notifyElevationSourceChange(){}}class u{constructor(e,t){this._elevationInfo=e,this._alignPointsInFeatures=t,this._alignmentsCache=new i.q(1024),this._cacheVersion=0}async alignCandidates(e,t,n){const i=this._elevationInfo;return null==i||"absolute-height"!==i.mode||i.featureExpressionInfo?this._alignComputedElevationCandidates(e,t,n):(function(e,t,n){const{offset:i,unit:o}=n;if(null==i)return;const r=(0,a.G9)(t),c=i*((0,s.Ao)(null!==o&&void 0!==o?o:"meters")/r);for(const a of e)switch(a.type){case"edge":a.start.z+=c,a.end.z+=c;continue;case"vertex":a.target.z+=c;continue}}(e,t,i),e)}notifyElevationSourceChange(){this._alignmentsCache.clear(),this._cacheVersion++}async _alignComputedElevationCandidates(e,t,n){const i=new Map;for(const r of e)(0,o.tE)(i,r.objectId,h).push(r);const[a,s,c]=this._prepareQuery(i,t),l=await this._alignPointsInFeatures(a,n);if((0,r.Te)(n),c!==this._cacheVersion)return this._alignComputedElevationCandidates(e,t,n);this._applyCacheAndResponse(a,l,s);const{drapedObjectIds:u,failedObjectIds:d}=l,p=[];for(const o of e){const{objectId:e}=o;u.has(e)&&"edge"===o.type&&(o.draped=!0),d.has(e)||p.push(o)}return p}_prepareQuery(e,t){const n=[],i=[];for(const[o,r]of e){const e=[];for(const t of r)this._addToQueriesOrCachedResult(o,t.target,e,i),"edge"===t.type&&(this._addToQueriesOrCachedResult(o,t.start,e,i),this._addToQueriesOrCachedResult(o,t.end,e,i));0!==e.length&&n.push({objectId:o,points:e})}return[{spatialReference:t.toJSON(),pointsInFeatures:n},i,this._cacheVersion]}_addToQueriesOrCachedResult(e,t,n,i){const o=p(e,t),r=this._alignmentsCache.get(o);null==r?n.push(t):i.push(new d(t,r))}_applyCacheAndResponse(e,t,n){let{elevations:i,drapedObjectIds:o,failedObjectIds:r}=t;for(const c of n)c.apply();let a=0;const s=this._alignmentsCache;for(const{objectId:c,points:l}of e.pointsInFeatures){if(r.has(c)){a+=l.length;continue}const e=!o.has(c);for(const t of l){const n=p(c,t),o=i[a++];t.z=o,e&&s.put(n,o,1)}}}}class d{constructor(e,t){this.point=e,this.z=t}apply(){this.point.z=this.z}}function p(e,t){let{x:n,y:i,z:o,spatialReference:r}=t;return"".concat(e,"-").concat(n,"-").concat(i,"-").concat(null!==o&&void 0!==o?o:0,"}-wkid:").concat(null===r||void 0===r?void 0:r.wkid)}function h(){return[]}},56002:(e,t,n)=>{function i(e){let t,n,i=[],o=!1;return function(){for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return o&&t===this&&function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(a,i)||(n=e.apply(this,a),t=this,i=a,o=!0),n}}n.d(t,{B:()=>i})},69963:(e,t,n)=>{n.d(t,{H:()=>s});n(81806);var i=n(53084),o=n(53521),r=n(50346),a=n(88685);function s(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?new l(arguments.length>1?arguments[1]:void 0):new c}class c{async fetch(){return[]}notifySymbologyChange(){}}class l{constructor(e){this._getSymbologyCandidates=e,this._candidatesCache=new o.q(1024),this._cacheVersion=0}async fetch(e,t){if(0===e.length)return[];const n=[],o=[],a=this._candidatesCache;for(const r of e){const e=u(r),t=a.get(e);if(t)for(const n of t)o.push((0,i.o8)(n));else n.push(r),a.put(e,[],1)}if(0===n.length)return o;const s=this._cacheVersion,{candidates:c,sourceCandidateIndices:l}=await this._getSymbologyCandidates(n,t);if((0,r.Te)(t),s!==this._cacheVersion)return this.fetch(e,t);const d=[],{length:p}=c;for(let r=0;r<p;++r){const e=c[r],t=u(n[l[r]]),o=a.get(t);o.push(e),a.put(t,o,o.length),d.push((0,i.o8)(e))}return o.concat(d)}notifySymbologyChange(){this._candidatesCache.clear(),this._cacheVersion++}}function u(e){switch(e.type){case"vertex":{var t;const{objectId:n,target:i}=e,o="".concat(n,"-vertex-").concat(i.x,"-").concat(i.y,"-").concat(null!==(t=i.z)&&void 0!==t?t:0);return(0,a.Wm)(o).toString()}case"edge":{var n,i;const{objectId:t,start:o,end:r}=e,s="".concat(t,"-edge-").concat(o.x,"-").concat(o.y,"-").concat(null!==(n=o.z)&&void 0!==n?n:0,"-to-").concat(r.x,"-").concat(r.y,"-").concat(null!==(i=r.z)&&void 0!==i?i:0);return(0,a.Wm)(s).toString()}default:return""}}},72317:(e,t,n)=>{n.d(t,{C:()=>s});var i=n(89379),o=n(75543),r=n(61751),a=n(23241);class s extends r.w{constructor(e){super((0,i.A)((0,i.A)({},e),{},{constraint:new o.i7(e.targetPoint)}))}get hints(){return[new a._(this.targetPoint,this.isDraped,this.domain)]}}},74964:(e,t,n)=>{n.d(t,{z:()=>a});n(81806);class i{filter(e,t){return t}notifyElevationSourceChange(){}}class o{filter(e,t){const{point:n,distance:i}=e,{z:o}=n;if(null==o)return t;if(0===t.length)return t;const a=function(e){return"number"==typeof e?{x:e,y:e,z:e}:e}(i),s=this._updateCandidatesTo3D(t,n,a).filter(r);return s.sort(l),s}_updateCandidatesTo3D(e,t,n){for(const i of e)switch(i.type){case"edge":s(i,t,n);continue;case"vertex":c(i,t,n);continue}return e}}function r(e){return e.distance<=1}function a(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?new o:new i}function s(e,t,n){let{x:i,y:o,z:r}=n;const{start:a,end:s,target:c}=e;e.draped||function(e,t,n,i){const o=i.x-n.x,r=i.y-n.y,a=i.z-n.z,s=o*o+r*r+a*a,c=(t.x-n.x)*o+(t.y-n.y)*r+a*(t.z-n.z),l=Math.min(1,Math.max(0,c/s)),u=n.x+o*l,d=n.y+r*l,p=n.z+a*l;e.x=u,e.y=d,e.z=p}(c,t,a,s);const l=(t.x-c.x)/i,u=(t.y-c.y)/o,d=(t.z-c.z)/r;e.distance=Math.sqrt(l*l+u*u+d*d)}function c(e,t,n){let{x:i,y:o,z:r}=n;const{target:a}=e,s=(t.x-a.x)/i,c=(t.y-a.y)/o,l=(t.z-a.z)/r,u=Math.sqrt(s*s+c*c+l*l);e.distance=u}function l(e,t){return e.distance-t.distance}},77567:(e,t,n)=>{n.r(t),n.d(t,{FeatureCollectionSnappingSource:()=>v});var i=n(35143),o=n(91967),r=n(56002),a=n(50346),s=n(68134),c=n(34154),l=n(46053),u=(n(81806),n(76460),n(47249),n(85842)),d=n(12482),p=n(70330),h=n(18153),y=n(35961),g=n(74964),f=n(69963);let v=class extends o.A{get availability(){return 1}get _snappingElevationAligner(){const{view:e}=this,{layer:t}=this.layerSource,n=null!=e&&"3d"===e.type;if(!n||"subtype-group"===t.type)return(0,y.n)();return(0,y.n)(n,{elevationInfo:t.elevationInfo,alignPointsInFeatures:async(n,i)=>(await(0,a.qr)(e.whenLayerView(t),i)).elevationAlignPointsInFeatures(n,i)})}get _snappingElevationFilter(){const{view:e}=this,t=null!=e&&"3d"===e.type&&"subtype-group"!==this.layerSource.layer.type;return(0,g.z)(t)}get _symbologySnappingFetcher(){const{view:e}=this,{layer:t}=this.layerSource;return null!=e&&"3d"===e.type&&"subtype-group"!==t.type?(0,f.H)(this._symbologySnappingSupported,async(n,i)=>{const o=await e.whenLayerView(t);return(0,a.Te)(i),o.queryForSymbologySnapping({candidates:n,spatialReference:e.spatialReference},i)}):(0,f.H)()}get _layerView(){const{view:e}=this;if(null==e)return null;const{layer:t}=this.layerSource;return e.allLayerViews.find(e=>e.layer===t)}get _layerView3D(){const{view:e}=this;return null==e||"2d"===e.type?null:this._layerView}get _symbologySnappingSupported(){return null!=this._layerView3D&&this._layerView3D.symbologySnappingSupported}initialize(){const{view:e}=this,{layer:t}=this.layerSource;null!=e&&"3d"===e.type&&"subtype-group"!==t.type&&this.addHandles([e.elevationProvider.on("elevation-change",e=>{let{context:n}=e;const{elevationInfo:i}=t;(0,d.Up)(n,i)&&this._snappingElevationAligner.notifyElevationSourceChange()}),(0,s.wB)(()=>t.elevationInfo,()=>this._snappingElevationAligner.notifyElevationSourceChange(),s.Vh),(0,s.wB)(()=>{var e;return null!=this._layerView3D?null===(e=this._layerView3D.layer)||void 0===e?void 0:e.renderer:null},()=>this._symbologySnappingFetcher.notifySymbologyChange(),s.Vh),(0,s.on)(()=>{var e;return null===(e=this._layerView3D)||void 0===e?void 0:e.layer},["edits","apply-edits","graphic-update"],()=>this._symbologySnappingFetcher.notifySymbologyChange())])}constructor(e){super(e),this.view=null,this.updating=!1,this._memoizedMakeGetGroundElevation=(0,r.B)(h.p)}refresh(){}async fetchCandidates(e,t){var n,i,o;const{layer:r}=this.layerSource,{source:s}=r;if(null===s||void 0===s||!s.querySnapping)return[];const l=r.createQuery();this._layerView&&"effectiveDisplayFilter"in this._layerView&&(l.where=(0,c.mA)(l.where,null===(n=this._layerView.effectiveDisplayFilter)||void 0===n?void 0:n.where));const u="returnZ"in r?r.returnZ:void 0,d=(0,p.nf)({parameters:e,mode:null!==(i=null===(o=this.view)||void 0===o?void 0:o.type)&&void 0!==i?i:"2d",returnZ:u,filter:l}),y=await s.querySnapping(d,{signal:t});(0,a.Te)(t);const g=e.coordinateHelper.spatialReference,f=await this._snappingElevationAligner.alignCandidates(y.candidates,g,t);(0,a.Te)(t);const v=await this._symbologySnappingFetcher.fetch(f,t);(0,a.Te)(t);const _=0===v.length?f:[...f,...v],w=this._snappingElevationFilter.filter(d,_),S=this._memoizedMakeGetGroundElevation(this.view,g);return w.map(e=>(0,h.$)(e,S))}};(0,i._)([(0,l.MZ)({constructOnly:!0})],v.prototype,"layerSource",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],v.prototype,"view",void 0),(0,i._)([(0,l.MZ)()],v.prototype,"_snappingElevationAligner",null),(0,i._)([(0,l.MZ)()],v.prototype,"_snappingElevationFilter",null),(0,i._)([(0,l.MZ)()],v.prototype,"_symbologySnappingFetcher",null),(0,i._)([(0,l.MZ)()],v.prototype,"_layerView",null),(0,i._)([(0,l.MZ)()],v.prototype,"_layerView3D",null),(0,i._)([(0,l.MZ)()],v.prototype,"_symbologySnappingSupported",null),v=(0,i._)([(0,u.$)("esri.views.interactive.snapping.featureSources.FeatureCollectionSnappingSource")],v)}}]);
//# sourceMappingURL=77567.960dd3ee.chunk.js.map