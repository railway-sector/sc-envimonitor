"use strict";(self.webpackChunksc_envimonitor=self.webpackChunksc_envimonitor||[]).push([[94089],{14318:(e,t,i)=>{i.d(t,{O:()=>d});var s=i(89379),n=i(35143),r=i(91967),a=i(30726),o=i(50346),l=i(46053),h=(i(81806),i(76460),i(47249),i(85842)),u=i(59752);let d=class extends r.A{constructor(e){super(e),this.constrainResult=e=>e,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=(0,o.sg)(async(e,t,i,n)=>{const r=this._frameTask;if(null==r)return;const a=await r.schedule(()=>t.snap((0,s.A)((0,s.A)({},e),{},{context:i,signal:n})),n);a.valid&&await r.schedule(()=>{this.stagedPoint=a.apply(),e!==this._snapPoints&&null!=this._snapPoints&&(this.stagedPoint=t.update((0,s.A)((0,s.A)({},this._snapPoints),{},{context:i})))},n)})}get stagedPoint(){return this._stagedPoint}set stagedPoint(e){this._stagedPoint=this.constrainResult(e)}initialize(){var e;const t="3d"===this.view.type?null===(e=this.view)||void 0===e||null===(e=e.resourceController)||void 0===e?void 0:e.scheduler:null;this._frameTask=null!=t?t.registerTask(u.W6.SNAPPING):u.nu}destroy(){this._abortController=(0,a.DC)(this._abortController),this._frameTask=(0,a.xt)(this._frameTask)}update(e,t,i){this._snapPoints=e;const{point:s,scenePoint:n}=e,r=t.update({point:s,scenePoint:n,context:i});return this.stagedPoint=r,r}async snap(e,t,i){const{point:s,scenePoint:n}=e;return this.stagedPoint=t.update({point:s,scenePoint:n,context:i}),this._snapPoints=e,null==this._abortController&&(this._abortController=new AbortController),this._snap(e,t,i,this._abortController.signal)}async snapAgainNearPreviousMapPoint(e,t){null!=this._snapPoints&&await this.snap(this._snapPoints,e,t)}abort(){this._abortController=(0,a.DC)(this._abortController),this._snapPoints=null}};(0,n._)([(0,l.MZ)({constructOnly:!0})],d.prototype,"view",void 0),(0,n._)([(0,l.MZ)()],d.prototype,"stagedPoint",null),(0,n._)([(0,l.MZ)()],d.prototype,"constrainResult",void 0),(0,n._)([(0,l.MZ)()],d.prototype,"_stagedPoint",void 0),d=(0,n._)([(0,h.$)("esri.views.interactive.snapping.SnappingOperation")],d)},38983:(e,t,i)=>{function s(e,t,i){i=i||2;var s,r,o,l,h,u,c,p=t&&t.length,g=p?t[0]*i:e.length,_=n(e,0,g,i,!0),m=[];if(!_||_.next===_.prev)return m;if(p&&(_=d(e,t,_,i)),e.length>80*i){s=o=e[0],r=l=e[1];for(var v=i;v<g;v+=i)(h=e[v])<s&&(s=h),(u=e[v+1])<r&&(r=u),h>o&&(o=h),u>l&&(l=u);c=0!==(c=Math.max(o-s,l-r))?1/c:0}return a(_,m,i,s,r,c),m}function n(e,t,i,s,n){var r,a;if(n===O(e,t,i,s)>0)for(r=t;r<i;r+=s)a=A(r,e[r],e[r+1],a);else for(r=i-s;r>=t;r-=s)a=A(r,e[r],e[r+1],a);if(a&&M(a,a.next)){var o=a.next;b(a),a=o}return a}function r(e,t){if(!e)return e;t||(t=e);var i,s=e;do{if(i=!1,s.steiner||!M(s,s.next)&&0!==w(s.prev,s,s.next))s=s.next;else{var n=s.prev;if(b(s),(s=t=n)===s.next)break;i=!0}}while(i||s!==t);return t}function a(e,t,i,s,n,d,c){if(e){!c&&d&&m(e,s,n,d);for(var p,g,_=e;e.prev!==e.next;)if(p=e.prev,g=e.next,d?l(e,s,n,d):o(e))t.push(p.i/i),t.push(e.i/i),t.push(g.i/i),b(e),e=g.next,_=g.next;else if((e=g)===_){c?1===c?a(e=h(r(e),t,i),t,i,s,n,d,2):2===c&&u(e,t,i,s,n,d):a(r(e),t,i,s,n,d,1);break}}}function o(e){var t=e.prev,i=e,s=e.next;if(w(t,i,s)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(f(t.x,t.y,i.x,i.y,s.x,s.y,n.x,n.y)&&w(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function l(e,t,i,s){var n=e.prev,r=e,a=e.next;if(w(n,r,a)>=0)return!1;for(var o=n.x<r.x?n.x<a.x?n.x:a.x:r.x<a.x?r.x:a.x,l=n.y<r.y?n.y<a.y?n.y:a.y:r.y<a.y?r.y:a.y,h=n.x>r.x?n.x>a.x?n.x:a.x:r.x>a.x?r.x:a.x,u=n.y>r.y?n.y>a.y?n.y:a.y:r.y>a.y?r.y:a.y,d=v(o,l,t,i,s),c=v(h,u,t,i,s),p=e.prevZ,g=e.nextZ;p&&p.z>=d&&g&&g.z<=c;){if(p!==e.prev&&p!==e.next&&f(n.x,n.y,r.x,r.y,a.x,a.y,p.x,p.y)&&w(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,g!==e.prev&&g!==e.next&&f(n.x,n.y,r.x,r.y,a.x,a.y,g.x,g.y)&&w(g.prev,g,g.next)>=0)return!1;g=g.nextZ}for(;p&&p.z>=d;){if(p!==e.prev&&p!==e.next&&f(n.x,n.y,r.x,r.y,a.x,a.y,p.x,p.y)&&w(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;g&&g.z<=c;){if(g!==e.prev&&g!==e.next&&f(n.x,n.y,r.x,r.y,a.x,a.y,g.x,g.y)&&w(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0}function h(e,t,i){var s=e;do{var n=s.prev,a=s.next.next;!M(n,a)&&P(n,s,s.next,a)&&L(n,a)&&L(a,n)&&(t.push(n.i/i),t.push(s.i/i),t.push(a.i/i),b(s),b(s.next),s=e=a),s=s.next}while(s!==e);return r(s)}function u(e,t,i,s,n,o){var l=e;do{for(var h=l.next.next;h!==l.prev;){if(l.i!==h.i&&x(l,h)){var u=C(l,h);return l=r(l,l.next),u=r(u,u.next),a(l,t,i,s,n,o),void a(u,t,i,s,n,o)}h=h.next}l=l.next}while(l!==e)}function d(e,t,i,s){var a,o,l,h=[];for(a=0,o=t.length;a<o;a++)(l=n(e,t[a]*s,a<o-1?t[a+1]*s:e.length,s,!1))===l.next&&(l.steiner=!0),h.push(y(l));for(h.sort(c),a=0;a<h.length;a++)i=r(i=g(h[a],i),i.next);return i}function c(e,t){return e.x-t.x}function p(e){if(e.next.prev===e)return e;let t=e;for(;;){const i=t.next;if(i.prev===t||i===t||i===e)break;t=i}return t}function g(e,t){var i=function(e,t){var i,s=t,n=e.x,r=e.y,a=-1/0;do{if(r<=s.y&&r>=s.next.y&&s.next.y!==s.y){var o=s.x+(r-s.y)*(s.next.x-s.x)/(s.next.y-s.y);if(o<=n&&o>a){if(a=o,o===n){if(r===s.y)return s;if(r===s.next.y)return s.next}i=s.x<s.next.x?s:s.next}}s=s.next}while(s!==t);if(!i)return null;if(n===a)return i;var l,h=i,u=i.x,d=i.y,c=1/0;s=i;do{n>=s.x&&s.x>=u&&n!==s.x&&f(r<d?n:a,r,u,d,r<d?a:n,r,s.x,s.y)&&(l=Math.abs(r-s.y)/(n-s.x),L(s,e)&&(l<c||l===c&&(s.x>i.x||s.x===i.x&&_(i,s)))&&(i=s,c=l)),s=s.next}while(s!==h);return i}(e,t);if(!i)return t;var s=C(i,e),n=r(i,i.next);let a=p(s);return r(a,a.next),n=p(n),p(t===i?n:t)}function _(e,t){return w(e.prev,e,t.prev)<0&&w(t.next,e,e.next)<0}function m(e,t,i,s){var n=e;do{null===n.z&&(n.z=v(n.x,n.y,t,i,s)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,i,s,n,r,a,o,l,h=1;do{for(i=e,e=null,r=null,a=0;i;){for(a++,s=i,o=0,t=0;t<h&&(o++,s=s.nextZ);t++);for(l=h;o>0||l>0&&s;)0!==o&&(0===l||!s||i.z<=s.z)?(n=i,i=i.nextZ,o--):(n=s,s=s.nextZ,l--),r?r.nextZ=n:e=n,n.prevZ=r,r=n;i=s}r.nextZ=null,h*=2}while(a>1)}(n)}function v(e,t,i,s,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-s)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function y(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function f(e,t,i,s,n,r,a,o){return(n-a)*(t-o)-(e-a)*(r-o)>=0&&(e-a)*(s-o)-(i-a)*(t-o)>=0&&(i-a)*(r-o)-(n-a)*(s-o)>=0}function x(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&P(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(L(e,t)&&L(t,e)&&function(e,t){var i=e,s=!1,n=(e.x+t.x)/2,r=(e.y+t.y)/2;do{i.y>r!=i.next.y>r&&i.next.y!==i.y&&n<(i.next.x-i.x)*(r-i.y)/(i.next.y-i.y)+i.x&&(s=!s),i=i.next}while(i!==e);return s}(e,t)&&(w(e.prev,e,t.prev)||w(e,t.prev,t))||M(e,t)&&w(e.prev,e,e.next)>0&&w(t.prev,t,t.next)>0)}function w(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function M(e,t){return e.x===t.x&&e.y===t.y}function P(e,t,i,s){var n=S(w(e,t,i)),r=S(w(e,t,s)),a=S(w(i,s,e)),o=S(w(i,s,t));return n!==r&&a!==o||!(0!==n||!V(e,i,t))||!(0!==r||!V(e,s,t))||!(0!==a||!V(i,e,s))||!(0!==o||!V(i,t,s))}function V(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function S(e){return e>0?1:e<0?-1:0}function L(e,t){return w(e.prev,e,e.next)<0?w(e,t,e.next)>=0&&w(e,e.prev,t)>=0:w(e,t,e.prev)<0||w(e,e.next,t)<0}function C(e,t){var i=new D(e.i,e.x,e.y),s=new D(t.i,t.x,t.y),n=e.next,r=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,s.next=i,i.prev=s,r.next=s,s.prev=r,s}function A(e,t,i,s){var n=new D(e,t,i);return s?(n.next=s.next,n.prev=s,s.next.prev=n,s.next=n):(n.prev=n,n.next=n),n}function b(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function D(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function O(e,t,i,s){for(var n=0,r=t,a=i-s;r<i;r+=s)n+=(e[a]-e[r])*(e[r+1]+e[a+1]),a=r;return n}i.d(t,{e:()=>s}),s.deviation=function(e,t,i,s){var n=t&&t.length,r=n?t[0]*i:e.length,a=Math.abs(O(e,0,r,i));if(n)for(var o=0,l=t.length;o<l;o++){var h=t[o]*i,u=o<l-1?t[o+1]*i:e.length;a-=Math.abs(O(e,h,u,i))}var d=0;for(o=0;o<s.length;o+=3){var c=s[o]*i,p=s[o+1]*i,g=s[o+2]*i;d+=Math.abs((e[c]-e[g])*(e[p+1]-e[c+1])-(e[c]-e[p])*(e[g+1]-e[c+1]))}return 0===a&&0===d?0:Math.abs((d-a)/a)},s.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},s=0,n=0;n<e.length;n++){for(var r=0;r<e[n].length;r++)for(var a=0;a<t;a++)i.vertices.push(e[n][r][a]);n>0&&(s+=e[n-1].length,i.holes.push(s))}return i}},46576:(e,t,i)=>{i.d(t,{T:()=>r});var s=i(29808),n=i(3112);function r(e){const t=new s.n(e);return t.options.store=n.o.MIN,t.options.excludeLabels=!0,t}},66678:(e,t,i)=>{i.d(t,{c:()=>o});var s=i(24648),n=i(7137),r=i(90659);const a=e=>({geodesicArea(t){const{spatialReference:i}=t;return(0,r.M0)(i,l,t=>function(e,t){try{return(0,s.gT)(Math.abs(e.geodesicArea(t,"square-meters")),"square-meters")}catch(i){return null}}(e,t),t)}});async function o(){const e=await Promise.all([i.e(52612),i.e(63391)]).then(i.bind(i,63391));return a(e)}function l(e){return(0,s.gT)(Math.abs((0,n.qy)([e],"square-meters")[0]),"square-meters")}},77515:(e,t,i)=>{i.d(t,{CL:()=>u,Gc:()=>c,OK:()=>h,s7:()=>p,uc:()=>l,zS:()=>d});var s=i(20664),n=i(9392),r=i(65215),a=i(78315),o=i(94966);function l(e,t){const i=(0,a.a)(t);(0,s.i)(i,0,0,0);for(let r=0;r<e.length;++r)(0,s.f)(i,i,e[r]);(0,s.g)(i,i,1/e.length);let n=0;for(let r=0;r<e.length;++r)n=Math.max(n,(0,s.s)(i,e[r]));t[3]=Math.sqrt(n)}function h(e,t){if(e.length<3)throw new Error("need at least 3 points to fit a plane");(0,o.e9)(e[0],e[1],e[2],t)}function u(e,t){return(0,s.e)(e,t)+e[3]}function d(e,t,i,n,r){let{geodesicArea:a}=r;const o=g;return(0,s.c)(o.rings[0][0],e),(0,s.c)(o.rings[0][1],t),(0,s.c)(o.rings[0][2],i),(0,s.c)(o.rings[0][3],e),o.spatialReference=n,o.clearCache(),a(o)}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=(e,t)=>{if(0===t[0]&&0===t[1]&&0===t[2])return!1;for(let i=0;i<e.length;++i)if((0,s.e)(t,e[i])<-1e-6)return!1;return!0};if(0===e.length)return!1;if(1===e.length)return t&&(0,s.c)(t,e[0]),!0;(0,s.i)(_,0,0,0);for(let r=0;r<e.length;++r)(0,s.f)(_,_,e[r]);if((0,s.n)(_,_),n(e,_))return t&&(0,s.c)(t,_),!0;if(!i)return!1;for(let r=0;r<e.length;++r)for(let i=0;i<e.length;++i)if(r!==i&&((0,s.h)(_,e[r],e[i]),(0,s.n)(_,_),n(e,_)))return t&&(0,s.c)(t,_),!0;return!1}function p(e){return"mouse"!==e.pointerType||0===e.button}const g=new r.A({hasM:!1,hasZ:!0,rings:[[(0,n.vt)(),(0,n.vt)(),(0,n.vt)(),(0,n.vt)()]],spatialReference:null}),_=(0,n.vt)()},78009:(e,t,i)=>{i.d(t,{EI:()=>c,lO:()=>y,qh:()=>p,u0:()=>v});var s=i(24648),n=i(31633),r=i(38983),a=i(20664),o=i(9392),l=i(14487),h=i(13927),u=i(45097),d=i(41868);function c(e){return g(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{positionsWorldCoords:[]})}function p(e){return g(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{positionsWorldCoords:[]},!1)}function g(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.hasZ;const r=(0,d.l)(e.spatialReference),c=(0,n.B5)(r);if(null==c)return null;const p=(e,t)=>!(t.length<2)&&((0,a.i)(e,t[0],t[1],i&&t[2]||0),!0);let g=0;for(const s of e.rings){const i=s.length;if(i<3)continue;const{positionsWorldCoords:n}=t;for(;n.length<i;)n.push((0,o.vt)());const d=_,c=(0,a.i)(m,0,0,0),v=1/i;for(let t=0;t<i;t++){if(!p(d,s[t]))return null;if(!(0,l.F)(d,e.spatialReference,n[t],r))return null;(0,a.b)(c,c,n[t],v)}const f=(0,h.Cr)(n[0],n[1],c,(0,h.LV)());if(0===(0,a.k)((0,h.Qj)(f)))continue;for(let e=0;e<i;e++)(0,h.Z1)(f,c,n[e],n[e]);const x=y(n);for(let e=0;e<x.length;e+=3)g+=(0,u.Fm)(n[x[e]],n[x[e+1]],n[x[e+2]])}return(0,s.gT)(g,c)}const _=(0,o.vt)(),m=(0,o.vt)();function v(){return{positionsWorldCoords:[]}}function y(e){return(0,r.e)(function(e){const t=new Float64Array(2*e.length);for(let i=0;i<e.length;++i){const s=e[i],n=2*i;t[n]=s[0],t[n+1]=s[1]}return t}(e),[],2)}},86401:(e,t,i)=>{i.d(t,{Ci:()=>r,KL:()=>l,dB:()=>o,l5:()=>a,wB:()=>h});var s=i(48549),n=i(66470);const r=(0,s.BP)().vec3f(n.r.POSITION),a=(0,s.BP)().vec3f(n.r.POSITION).vec2f16(n.r.UV0),o=(0,s.BP)().vec3f(n.r.POSITION).vec4u8(n.r.COLOR),l=((0,s.BP)().vec3f(n.r.POSITION).vec2f16(n.r.UV0).vec4u8(n.r.OLIDCOLOR),(0,s.BP)().vec3f(n.r.POSITION).vec2f(n.r.UV0)),h=(0,s.BP)().vec3f(n.r.POSITION).vec2f(n.r.UV0).vec4u8(n.r.OLIDCOLOR)},87230:(e,t,i)=>{i.d(t,{C:()=>v,b:()=>m});var s,n,r=i(57528),a=i(26917),o=i(94192),l=i(80883),h=i(3799),u=i(95756),d=i(58350),c=i(86955),p=i(66470),g=i(91911),_=i(2687);function m(e){const t=new _.N5,{vertex:i,fragment:m,varyings:v}=t;return t.fragment.include(a.HQ,e),t.include(o.Z,e),t.include(g.z,e),(0,h.NB)(i,e),t.attributes.add(p.r.POSITION,"vec3"),t.attributes.add(p.r.UV0,"vec2"),v.add("vUV","vec2"),v.add("vpos","vec3"),i.main.add((0,c.H)(s||(s=(0,r.A)(["vUV = uv0;\nvpos = position;\nforwardViewPosDepth((view * vec4(position, 1.0)).xyz);\ngl_Position = proj * view * vec4(position, 1.0);"])))),m.uniforms.add(new u.G("size",e=>e.size)),m.uniforms.add(new d.E("color1",e=>e.color1)),m.uniforms.add(new d.E("color2",e=>e.color2)),m.include(l.a),m.main.add((0,c.H)(n||(n=(0,r.A)(["discardByTerrainDepth();\nvec2 uvScaled = vUV / (2.0 * size);\nvec2 uv = fract(uvScaled - 0.25);\nvec2 ab = clamp((abs(uv - 0.5) - 0.25) / fwidth(uvScaled), -0.5, 0.5);\nfloat fade = smoothstep(0.25, 0.5, max(fwidth(uvScaled.x), fwidth(uvScaled.y)));\nfloat t = mix(abs(ab.x + ab.y), 0.5, fade);\nfragColor = mix(color2, color1, t);\noutputColorHighlightOID(fragColor, vpos, fragColor.rgb);"])))),t}const v=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}))},87562:(e,t,i)=>{var s;i.d(t,{G:()=>s}),function(e){e[e.Auto=0]="Auto",e[e.Euclidean=1]="Euclidean",e[e.Geodesic=2]="Geodesic"}(s||(s={}))},94089:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Rt});var s=i(35143),n=i(91967),r=(i(81806),i(30726)),a=i(46053),o=i(76460),l=(i(47249),i(85842)),h=i(19747),u=i(2522),d=i(87562),c=i(68134),p=i(15941),g=i(24648),_=i(31633),m=i(19555),v=i(72745),y=i(20664),f=i(9392),x=i(55855),w=i(34111),M=i(9956),P=i(98510),V=i(14487);function S(e,t,i,s,n){(0,y.c)(L,e),(0,y.f)(C,e,t),(0,V.F)(L,i,L,n),(0,V.F)(C,i,C,n),(0,y.d)(s,C,L),(0,y.n)(s,s)}const L=(0,f.vt)(),C=(0,f.vt)();var A=i(64232),b=i(5568),D=i(38496),O=i(65658),R=i(78315),Z=i(45097),T=i(77515),I=i(80935),G=i(94966),z=i(78009),k=i(29772),H=i(90659),E=i(41868);class W{get numVertices(){return this._length}get hasStagedVertex(){return null!=this._lastCursorPoint}constructor(e,t,i){var s,n;this._sceneView=e,this._geodesicAreaMeasurementUtils=t,this._geodesicLengthMeasurementUtils=i,this.validMeasurement=!1,this.positionsWorld=[],this.positionsRender=[],this.positionsFittedWorld=[],this.positionsFittedRender=[],this.positionsGeodesic=[],this.positionsSpherical=[],this.positionsStereographic=[],this.pathSegmentLengths=[],this.geodesicPathSegmentLengths=[],this.perimeterSegmentLengths=[],this.intersectingSegments=new Set,this.geodesicIntersectingSegments=new Set,this.triangleIndices=null,this.geodesicTriangleIndices=null,this.areaCentroidWorldCoords=(0,f.vt)(),this.areaCentroidRenderCoords=(0,f.vt)(),this.geodesicAreaCentroidRenderCoords=(0,f.vt)(),this.fittingMode=null,this.area=null,this.geodesicArea=null,this.pathLength=null,this.geodesicPathLength=null,this.perimeterLength=null,this._length=0,this._centroidRenderCoords=(0,f.vt)(),this._planeWorldCoords=(0,x.vt)(),this._worldUp=(0,f.vt)(),this._worldTangent=(0,f.vt)(),this._frame=[(0,f.vt)(),(0,f.vt)(),(0,f.vt)()],this._lastPathVersion=-1,this._lastCursorPoint=null,this._mode=null,this._tempU=(0,f.vt)(),this._tempV=(0,f.vt)(),this._tempVec3=(0,f.vt)(),this._tempSphere=(0,R.c)();const r=(0,E.l)(e.spatialReference);this._measurementSR=r,this._lengthMeasurementUnit=null!==(s=(0,_._H)(r))&&void 0!==s?s:"meters",this._areaMeasurementUnit=null!==(n=(0,_.B5)(r))&&void 0!==n?n:"square-meters"}update(e,t,i,s,n,r){const a=this._lastPathVersion===e.version,o=t?t.equals(this._lastCursorPoint):null==this._lastCursorPoint,l=this._mode===n;return!(a&&!r&&l&&o)&&(this._lastPathVersion=e.version,this._lastCursorPoint=t,this._updateCursorSegmentLength(e,t),this._update(e,t,i,s,n),!0)}_update(e,t,i,s,n){const r=this._sceneView.renderSpatialReference,a=this._measurementSR,o=i.spatialReference;let l=e.numVertices;const h=!(null==t||t.equals(e.lastPoint)||l>2&&t.equals(e.firstPoint)||e.polygonIsClosed);h&&(l+=1);const u=!e.polygonIsClosed&&l>2,d=e.polygonIsClosed||u;this._resize(l);const c=(0,P.lO)(o),p=null!=o&&(0,H.yF)(o)?o:null,_=null!=p&&(0,M.canProjectWithoutEngine)(o,c),{positionsGeodesic:m,positionsWorld:v,positionsRender:f,positionsSpherical:x}=this,w=(e,t)=>{(function(e,t){var i;t.hasZ||(t.z=null!==(i=(0,I.R1)(e,t,"ground"))&&void 0!==i?i:0)})(i.elevationProvider,e),(0,A.g)(e,v[t],a),(0,A.g)(e,f[t],r),_&&((0,A.g)(e,m[t],p),(0,A.g)(e,x[t],c),(0,y.n)(x[t],x[t]))};e.forEachVertexPosition((e,t)=>w(e,t)),h&&w(t,l-1);const V=this._updatePathLengths(d);if(this.pathLength=this._length>1?(0,g.d_)(V,this._lengthMeasurementUnit):null,_){const e=this._updateGeodesicPathLengths(d,p);this.geodesicPathLength=null!=e&&this._length>1?e:null}else this.geodesicPathLength=null;if(this._updateMode(n),!d)return this.area=null,this.geodesicArea=null,this.perimeterLength=null,this.triangleIndices=null,this.geodesicTriangleIndices=null,this.intersectingSegments.clear(),this.geodesicIntersectingSegments.clear(),void(this.validMeasurement=!1);this._updateAreaAndPerimeterLength(i,r,a,s),_&&this._updateGeodesicArea(i,p),this.validMeasurement=!0}getData(){return{validMeasurement:this.validMeasurement,numVertices:this.numVertices,hasStagedVertex:this.hasStagedVertex,positionsRender:this.positionsRender,positionsFittedWorld:this.positionsFittedWorld,positionsFittedRender:this.positionsFittedRender,intersectingSegments:this.intersectingSegments,geodesicIntersectingSegments:this.geodesicIntersectingSegments,triangleIndices:this.triangleIndices,geodesicTriangleIndices:this.geodesicTriangleIndices,areaCentroidRenderCoords:this.areaCentroidRenderCoords,geodesicAreaCentroidRenderCoords:this.geodesicAreaCentroidRenderCoords,area:this.area,geodesicArea:this.geodesicArea,pathLength:this.pathLength,geodesicPathLength:this.geodesicPathLength,perimeterLength:this.perimeterLength,actualMeasurementMode:this.actualMeasurementMode}}_resize(e){for(e<this._length&&(this.positionsWorld.length=e,this.positionsRender.length=e,this.positionsFittedWorld.length=e,this.positionsFittedRender.length=e,this.positionsGeodesic.length=e,this.positionsSpherical.length=e,this.positionsStereographic.length=e,this.pathSegmentLengths.length=e,this.geodesicPathSegmentLengths.length=e,this.perimeterSegmentLengths.length=e,this._length=e);this._length<e;)this.positionsWorld.push((0,f.vt)()),this.positionsRender.push((0,f.vt)()),this.positionsFittedWorld.push((0,v.vt)()),this.positionsFittedRender.push((0,f.vt)()),this.positionsGeodesic.push((0,f.vt)()),this.positionsSpherical.push((0,f.vt)()),this.positionsStereographic.push((0,v.vt)()),this.pathSegmentLengths.push(0),this.geodesicPathSegmentLengths.push(0),this.perimeterSegmentLengths.push(0),++this._length}_updatePathLengths(e){const t=this.positionsWorld,i=this.pathSegmentLengths;let s=0;const n=this._length;for(let r=0;r<n;++r){const a=i[r]=(0,y.j)(t[r],t[(r+1)%n]);(r<n-1||e)&&(s+=a)}return s}_updateGeodesicPathLengths(e,t){const i=this.positionsGeodesic,s=this.geodesicPathSegmentLengths;let n=0;const r=this._length;for(let a=0;a<r;++a){const o=this._geodesicLengthMeasurementUtils.geodesicDistance(i[a],i[(a+1)%r],t);if(null==o)return null;const l=(0,g.kM)(o,"meters").value,h=s[a]=l;(a<r-1||e)&&(n+=h)}return(0,g.d_)(n,"meters")}_updateAreaAndPerimeterLength(e,t,i,s){const n=e.renderCoordsHelper,r=this.positionsWorld,a=this.positionsRender,o=this.positionsFittedWorld,l=this.positionsFittedRender,h=this._planeWorldCoords,u=this._centroidRenderCoords;(0,G.ix)(a,u),n.worldUpAtPosition(u,this._worldUp),n.worldBasisAtPosition(u,b._.X,this._worldTangent),S(u,this._worldUp,t,this._worldUp,i),S(u,this._worldTangent,t,this._worldTangent,i),r.length>2&&(0,T.OK)(r,h),this.fittingMode=this._selectFittingMode(h,r,this._worldUp,s);let d=0;if("horizontal"===this.fittingMode){let e=-1/0;a.forEach((t,i)=>{const s=n.getAltitude(a[i]);s>e&&(e=s,d=i)})}const c=r[d];let p=h,g=this._worldTangent;"horizontal"===this.fittingMode?p=this._worldUp:"vertical"===this.fittingMode&&(p=this._tempVec3,g=this._worldUp,(0,G.YH)(h,this._worldUp,p)),(0,y.c)(this._frame[2],p),(0,G.YH)(g,p,this._frame[0]),(0,y.h)(this._frame[1],this._frame[0],this._frame[2]),(0,y.u)(this._frame[1],this._frame[1]);const _=this._tempVec3,v=this._tempU,f=this._tempV;for(let x=0;x<this._length;++x){const e=o[x],s=l[x];(0,y.d)(_,r[x],c),(0,m.hZ)(e,(0,y.e)(this._frame[0],_),(0,y.e)(this._frame[1],_)),(0,y.g)(v,this._frame[0],e[0]),(0,y.g)(f,this._frame[1],e[1]),(0,y.f)(_,v,f),(0,y.f)(_,_,c),(0,V.F)(_,i,s,t)}this.perimeterLength=this._length>0?this._updatePerimeterLengths():null,(0,G.ix)(l,this.areaCentroidRenderCoords),(0,V.F)(this.areaCentroidRenderCoords,t,this.areaCentroidWorldCoords,i),this._updateIntersectingSegments(),this.area=0===this.intersectingSegments.size?this._computeArea():null}_updateGeodesicArea(e,t){const{renderCoordsHelper:i,spatialReference:s}=e,{positionsSpherical:n,positionsStereographic:r}=this,a=this._tempVec3,o=(0,T.Gc)(n,a);if(!o)return void(this.geodesicArea=null);const l=this._tempU,h=this._tempV;(0,G.VV)(a,l,h);for(let u=0;u<this._length;++u){const e=(0,y.e)(n[u],l),t=(0,y.e)(n[u],h),i=(0,y.e)(n[u],a);(0,m.hZ)(r[u],e/i,t/i)}(0,y.g)(a,a,(0,w.tO)(s).radius),i.toRenderCoords(a,(0,P.lO)(s),this.geodesicAreaCentroidRenderCoords),this._updateGeodesicIntersectingSegments(),this.geodesicArea=o&&0===this.geodesicIntersectingSegments.size?this._computeGeodesicArea(t):null}_updatePerimeterLengths(){const e=this.positionsFittedWorld,t=this.perimeterSegmentLengths;let i=0;for(let s=0;s<this._length;++s)i+=t[s]=(0,m.Io)(e[s],e[(s+1)%this._length]);return(0,g.d_)(i,this._lengthMeasurementUnit)}_updateIntersectingSegments(){const e=this.positionsFittedWorld,t=this.intersectingSegments;t.clear();for(let i=0;i<this._length;++i)for(let s=i+2;s<this._length;++s){if((s+1)%this._length===i)continue;const n=e[i],r=e[(i+1)%this._length],a=e[s],o=e[(s+1)%this._length];(0,O.Ql)(n,r,a,o)&&(t.add(i),t.add(s))}}_computeArea(){const e=this.positionsFittedWorld,t=this.triangleIndices=(0,D.Dg)((0,z.lO)(e));let i=0;for(let s=0;s<t.length;s+=3)i+=(0,Z.Fm)(e[t[s]],e[t[s+1]],e[t[s+2]]);return(0,g.gT)(i,this._areaMeasurementUnit)}_updateGeodesicIntersectingSegments(){const e=this.positionsStereographic,t=this.geodesicIntersectingSegments;t.clear();for(let i=0;i<this._length;++i)for(let s=i+2;s<this._length;++s){if((s+1)%this._length===i)continue;const n=e[i],r=e[(i+1)%this._length],a=e[s],o=e[(s+1)%this._length];(0,O.Ql)(n,r,a,o)&&(t.add(i),t.add(s))}}_computeGeodesicArea(e){const t=this.positionsGeodesic,i=this.positionsStereographic,s=this.geodesicTriangleIndices=(0,D.Dg)((0,z.lO)(i));let n=0;for(let r=0;r<s.length;r+=3){const i=(0,T.zS)(t[s[r]],t[s[r+1]],t[s[r+2]],e,this._geodesicAreaMeasurementUtils);if(null==i)return null;n+=(0,g.kM)(i,"square-meters").value}return(0,g.gT)(n,"square-meters")}_selectFittingMode(e,t,i,s){const n=t.map(t=>Math.abs((0,T.CL)(e,t))).reduce((e,t)=>Math.max(e,t),0);(0,T.uc)(t,this._tempSphere);const r=n/(2*this._tempSphere[3]),a=r<s.maxRelativeErrorCoplanar,o=r<s.maxRelativeErrorAlmostCoplanar;let l="horizontal";return a?l="oblique":o&&(l=Math.abs((0,y.e)(i,e))>Math.cos((0,p.kU)(s.verticalAngleThreshold))?"horizontal":"vertical"),l}_updateCursorSegmentLength(e,t){var i;const s=e.lastPoint;e.isValidPolygon||null==s||null==t?(this.geodesicStagedSegmentLength=null,this.stagedSegmentLength=null):(this.geodesicStagedSegmentLength=this._geodesicLengthMeasurementUtils.geodesicDistanceBetweenPoints(s,t),this.stagedSegmentLength=null===(i=(0,k.NH)(s,t))||void 0===i?void 0:i.direct)}_updateMode(e){if(e===d.G.Auto){this.actualMeasurementMode="euclidean";let e=0;null!=this.geodesicPathLength&&(e+=this.geodesicPathLength.value),e>F&&(this.actualMeasurementMode="geodesic")}else this.actualMeasurementMode=e===d.G.Euclidean?"euclidean":"geodesic";null==this.geodesicPathLength&&(this.actualMeasurementMode="euclidean"),this._mode=e}}const F=1e5;let U=class extends n.A{constructor(e){super(e)}initialize(){this._measurementDataManager=new W(this.view,this.geodesicAreaMeasurementUtils,this.geodesicLengthMeasurementUtils),this.addHandles([this.analysisViewData.path.on("change",()=>this._update()),(0,c.wB)(()=>this.analysisViewData.stagedPoint,()=>this._update(),c.OH),(0,c.wB)(()=>this.analysisViewData.mode,()=>this._update(),c.OH)]),this._update()}_update(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{analysisViewData:t,view:i}=this;this._measurementDataManager.update(t.path,t.stagedPoint,i,{maxRelativeErrorCoplanar:.005,maxRelativeErrorAlmostCoplanar:.01,verticalAngleThreshold:80},t.mode,e)&&(t.measurementData=this._measurementDataManager.getData())}};(0,s._)([(0,a.MZ)({constructOnly:!0})],U.prototype,"view",void 0),(0,s._)([(0,a.MZ)({constructOnly:!0})],U.prototype,"analysis",void 0),(0,s._)([(0,a.MZ)({constructOnly:!0})],U.prototype,"analysisViewData",void 0),(0,s._)([(0,a.MZ)({constructOnly:!0})],U.prototype,"geodesicAreaMeasurementUtils",void 0),(0,s._)([(0,a.MZ)({constructOnly:!0})],U.prototype,"geodesicLengthMeasurementUtils",void 0),U=(0,s._)([(0,l.$)("esri.views.3d.analysis.AreaMeasurement.support.AreaMeasurementController")],U);var B=i(54099),q=i(19247),N=i(2413),j=i(17430),$=i(89238),Q=i(974),K=i(59833);let J=class extends B.A.EventedAccessor{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this._version=0,this._internalGeometryChange=!1,this._extent=(0,N.Ie)()}set areaMeasurement(e){this._set("areaMeasurement",e),null!=e&&null!=this.view&&this._initialize(e,this.view)}set view(e){this._set("view",e),null!=e&&null!=this.areaMeasurement&&this._initialize(this.areaMeasurement,e)}get constructed(){return null!=this.areaMeasurement&&null!=this.view}get version(){return this._version}get isEmptyPolygon(){return!this.constructed||0===this._editGeometry.components.length}get isValidPolygon(){return this.constructed&&this.polygonIsClosed}get extent(){if(this.constructed&&this._editGeometry.components.length>0&&this._editGeometry.components[0].vertices.length>0){const e=(0,N.Ie)(this._extent);return this.forEachVertex(t=>{(0,N.tK)(e,t.pos)}),e}return null}get spatialReference(){return this.constructed?this._editGeometry.coordinateHelper.spatialReference:null}_initialize(e,t){this.removeAllHandles(),this.addHandles((0,c.wB)(()=>e.geometry,()=>{this._updateEditGeometryFromModelGeometry(e,t)},c.pc)),this._makeDirty(!0)}_makeDirty(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.notifyChange("polygonIsClosed"),this.notifyChange("isValidPolygon"),this.notifyChange("initialized"),this.notifyChange("extent"),e&&this.notifyChange("numVertices")}_updateEditGeometryFromModelGeometry(e,t){if(this._version++,this._internalGeometryChange)return;this.removeHandles("EditGeometry");let i=e.geometry;if(null!=i){const s=(0,M.tryProjectWithZConversion)(i,t.spatialReference);null==s&&(0,j.V)(e,i.spatialReference,o.A.getLogger(this)),i=s}this._editGeometryOperations=null!=i?K.p.fromGeometry(i,t.state.viewingMode):new K.p(new Q.ZE("polygon",(0,$.BV)(!0,!1,t.spatialReference)),t.state.viewingMode),this._makeDirty(!0),this.emit("change"),this.addHandles(this._editGeometry.on("change",t=>{this._makeDirty(null!=t.addedVertices||null!=t.removedVertices),this._internalGeometryChange=!0,e.geometry=this.numVertices>0?this._editGeometry.geometry:null,this._internalGeometryChange=!1}),"EditGeometry")}get _editGeometry(){return this._editGeometryOperations.data}get vertices(){const e=[];return this.forEachVertex(t=>{e.push(t)}),e}get numVertices(){return this.constructed&&this._editGeometry.components.length>0?this._editGeometry.components[0].vertices.length:0}get polygonIsClosed(){return this._editGeometry.components.length>0&&this._editGeometry.components[0].isClosed()}get firstPoint(){if(this.constructed&&this._editGeometry.components.length>0){const e=this._editGeometry.components[0].getFirstVertex();if(null!=e)return this._editGeometry.coordinateHelper.vectorToPoint(e.pos)}return null}get lastPoint(){if(this.constructed&&this._editGeometry.components.length>0){const e=this._editGeometry.components[0].getLastVertex();if(null!=e)return this._editGeometry.coordinateHelper.vectorToPoint(e.pos)}return null}getVertex(e){if(!this.constructed||0===this._editGeometry.components.length||0===this._editGeometry.components[0].vertices.length)return null;const t=this._editGeometry.components[0].vertices[0];let i=t;do{if(i.index===e)return i;i=i.rightEdge.rightVertex}while(i!==t&&null!=i);return null}getVertexPositionAsPoint(e){return this._editGeometry.coordinateHelper.vectorToPoint(e.pos)}getVertexPositionAsPointFromIndex(e){return this._editGeometry.coordinateHelper.vectorToPoint(this.getVertex(e).pos)}forEachVertex(e){this.constructed&&this._editGeometry.components.length>0&&this._editGeometry.components[0].iterateVertices(e)}forEachVertexPosition(e){const t=this._editGeometry.coordinateHelper;this.forEachVertex((i,s)=>{t.vectorToPoint(i.pos,X),e(X,s)})}clear(){null!=this.areaMeasurement&&(this.areaMeasurement.geometry=null)}add(e){if(!this.constructed)return null;if(0===this._editGeometry.components.length){const e=this.view;this._editGeometry.components.push(new Q.uA(e.spatialReference,e.state.viewingMode))}const t=this._editGeometryOperations.appendVertex(this._editGeometry.coordinateHelper.pointToVector(e));return this.emit("change"),t}close(){if(!this.constructed||0===this._editGeometry.components.length)return null;const e=this._editGeometryOperations.closeComponent(this._editGeometry.components[0]);return this.emit("change"),e}ensureContains(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=!1;if(this._editGeometry.components.forEach(t=>{t.iterateVertices(t=>{t===e&&(i=!0)})}),!i)throw new Error("vertex doesnt exist ".concat(t));return i}setVertexPosition(e,t){if(!this.constructed)return null;const i=this._editGeometryOperations.setVertexPosition(e,this._editGeometry.coordinateHelper.pointToVector(t));return this.emit("change"),i}equals(e){if(this.numVertices!==e.numVertices)return!1;let t=!0;return this.forEachVertexPosition((i,s)=>{const n=e.getVertexPositionAsPointFromIndex(s);i.equals(n)||(t=!1)}),!!t}};(0,s._)([(0,a.MZ)({value:null})],J.prototype,"areaMeasurement",null),(0,s._)([(0,a.MZ)({value:null})],J.prototype,"view",null),(0,s._)([(0,a.MZ)()],J.prototype,"isEmptyPolygon",null),(0,s._)([(0,a.MZ)()],J.prototype,"isValidPolygon",null),(0,s._)([(0,a.MZ)()],J.prototype,"extent",null),(0,s._)([(0,a.MZ)()],J.prototype,"spatialReference",null),(0,s._)([(0,a.MZ)()],J.prototype,"numVertices",null),(0,s._)([(0,a.MZ)()],J.prototype,"polygonIsClosed",null),J=(0,s._)([(0,l.$)("esri.views.3d.analysis.AreaMeasurement.support.AreaMeasurementPathHelper")],J);const X=new q.A;var Y=i(89379),ee=(i(11265),i(59784)),te=i(11113),ie=i(34761),se=i(13191);function ne(e,t){return(0,g.kM)(e,(0,_.cT)(e.value,e.unit,t))}function re(e,t){return(0,g.kM)(e,ae(e,t))}function ae(e,t){const i=function(e){switch(e){case"metric":case"ares":case"hectares":return"metric";case"imperial":case"acres":return"imperial";case"square-inches":return"inches";case"square-feet":return"feet";case"square-yards":return"yards";case"square-miles":return"miles";case"square-nautical-miles":return"nautical-miles";case"square-us-feet":return"us-feet";case"square-millimeters":return"millimeters";case"square-centimeters":return"centimeters";case"square-decimeters":return"decimeters";case"square-meters":return"meters";case"square-kilometers":return"kilometers"}throw new Error("unhandled area unit")}(t);return(0,_.Vs)(e.value,e.unit,i)}var oe=i(66747),le=i(7256),he=i(43047),ue=i(32314),de=i(50468),ce=i(17345),pe=i(45463),ge=i(66470),_e=i(34981),me=i(59696),ve=i(77730),ye=i(82809),fe=i(86401),xe=i(63928),we=i(16506),Me=i(59246),Pe=i(72001),Ve=i(60322),Se=i(87230),Le=i(57162);class Ce extends Me.w{constructor(e,t){super(e,t,new we.$(Se.C,()=>i.e(62028).then(i.bind(i,62028))))}initializePipeline(e){const{oitPass:t,transparent:i,polygonOffset:s,output:n}=e,r=t===Pe.Y.NONE,a=t===Pe.Y.FrontFace;return(0,Le.Ey)({blending:i?(0,Ve.Yf)(t):null,depthTest:{func:(0,Ve.K_)(t)},depthWrite:(0,Ve.z5)(e),drawBuffers:(0,Ve.m6)(t,n),colorWrite:Le.kn,polygonOffset:r||a?s?Ae:null:{factor:-1,units:-25}})}}const Ae={factor:0,units:-25};var be=i(97808),De=i(42717),Oe=i(6485),Re=i(92656);class Ze extends Re.E{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.polygonOffset=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.textureCoordinateType=be.I.None,this.emissionSource=De.ZX.None,this.output=_e.V.Color,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1,this.overlayEnabled=!1,this.draped=!1,this.snowCover=!1}get discardInvisibleFragments(){return this.transparent&&this.writeDepth}}(0,s._)([(0,Oe.W)()],Ze.prototype,"transparent",void 0),(0,s._)([(0,Oe.W)()],Ze.prototype,"writeDepth",void 0),(0,s._)([(0,Oe.W)()],Ze.prototype,"polygonOffset",void 0),(0,s._)([(0,Oe.W)()],Ze.prototype,"terrainDepthTest",void 0),(0,s._)([(0,Oe.W)()],Ze.prototype,"cullAboveTerrain",void 0);var Te=i(75569);class Ie extends xe.W{constructor(e){super(e,ze),this._configuration=new Ze,this.produces=new Map([[ve.N.OPAQUE_MATERIAL,e=>(0,_e._o)(e)&&!this.transparent],[ve.N.TRANSPARENT_MATERIAL,e=>(0,_e._o)(e)&&this.transparent&&this.parameters.writeDepth],[ve.N.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,e=>(0,_e._o)(e)&&this.transparent&&!this.parameters.writeDepth]])}getConfiguration(e,t){return super.getConfiguration(e,t,this._configuration),this._configuration.transparent=this.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.oitPass=t.oitPass,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration}get visible(){return this.parameters.color1[3]>=Te.Q||this.parameters.color2[3]>=Te.Q}get transparent(){return this.parameters.color1[3]<1||this.parameters.color2[3]<1}createGLMaterial(e){return new Ge(e)}createBufferWriter(){return new ye.Z(fe.l5)}}class Ge extends me.A{beginSlot(e){return this.getTechnique(Ce,e)}}class ze extends pe.qA{constructor(){super(...arguments),this.size=(0,v.fA)(1,1),this.color1=(0,x.fA)(.75,.75,.75,1),this.color2=(0,x.fA)(.5,.5,.5,1),this.writeDepth=!0,this.polygonOffset=!1}}class ke extends ue.X{constructor(e){super(e),this._checkerBoardMaterial=null,this._renderOccluded=pe.m$.OccludeAndTransparent,this._geometry=null,this._size=(0,v.fA)(1,1),this._color1=(0,x.fA)(1,.5,0,.5),this._color2=(0,x.fA)(1,1,1,.5),this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get size(){return this._size}set size(e){(0,m.C)(this._size,e),this._updateMaterial()}get color1(){return this._color1}set color1(e){(0,he.a)(e,this._color1)||((0,he.c)(this._color1,e),this._updateMaterial())}get color2(){return this._color2}set color2(e){(0,he.a)(e,this._color2)||((0,he.c)(this._color2,e),this._updateMaterial())}_updateMaterial(){var e;null===(e=this._checkerBoardMaterial)||void 0===e||e.setParameters({size:this._size,color1:this._color1,color2:this._color2,renderOccluded:this._renderOccluded})}createExternalResources(){this._checkerBoardMaterial=new Ie({size:this._size,color1:this._color1,color2:this._color2,writeDepth:!1,polygonOffset:!0,renderOccluded:pe.m$.OccludeAndTransparent,isDecoration:this.isDecoration})}destroyExternalResources(){this._checkerBoardMaterial=null}forEachMaterial(e){e(this._checkerBoardMaterial)}createGeometries(e){if(null==this._geometry||null==this._checkerBoardMaterial)return;const t=He;(0,ie.sC)(t,this.transform);const i=this._geometry,s=[],n=(0,f.vt)();i.position.forEach(e=>{(0,y.d)(n,e,t),s.push(n[0],n[1],n[2])});const r=[];i.uv.forEach(e=>{r.push(e[0],e[1])});const a=new ce.V(this._checkerBoardMaterial,[[ge.r.POSITION,new de.n(s,i.triangleIndices,3,!0)],[ge.r.UV0,new de.n(r,i.triangleIndices,2,!0)]]);e.addGeometry(a)}}const He=(0,f.vt)();var Ee=i(25191),We=i(35925),Fe=i(38042),Ue=i(63860);let Be=class extends n.A{get _parameters(){const{accentColor:e,textColor:t}=this.view.effectiveTheme,i=(0,ee.QP)(e),s=(0,ee.f6)(e,.5),n=(0,ee.f6)((0,ee.bJ)(e),.5),r=(0,ee.bJ)(t,ee.pW.Low);return{accentColor:i,transparentAccentColor:s,transparentContrastColor:n,intersectingLineColor:[1,.2,0,1],textColor:t,textBackgroundColor:(0,ee._L)(r,.6),textCalloutColor:(0,ee._L)(r,.5),pathLineWidth:3,perimeterLineWidth:2,projectionLineWidth:2,projectionLineStippleSize:5,labelDistance:25}}get visible(){return this.analysisViewData.visible}get _renderUnits(){var e;const t=this.view.renderCoordsHelper.spatialReference;return null!==(e=(0,_._H)(t))&&void 0!==e?e:"meters"}get testData(){}constructor(e){super(e),this._path=null,this._intersectedPath=null,this._perimeter=null,this._intersectedPerimeter=null,this._projectionLines=null,this._measurementArea=null,this._areaLabel=null,this._perimeterLengthLabel=null,this._pathSegments=[],this._perimeterSegments=[],this._origin=(0,f.vt)(),this._originTransform=(0,se.vt)(),this.messages=null,this.viewData=je,this.areaLabel=null,this.perimeterLengthLabel=null,this.loadingMessages=!0}initialize(){const{analysisViewData:e,_parameters:t,view:i}=this;this._path=new le.t({view:i,attached:!0,width:t.pathLineWidth,polygonOffset:!0,renderOccluded:pe.m$.OccludeAndTransparent,isDecoration:!0}),this._intersectedPath=new le.t({view:i,attached:!0,width:t.pathLineWidth,polygonOffset:!0,renderOccluded:pe.m$.OccludeAndTransparent,isDecoration:!0}),this._perimeter=new le.t({view:i,attached:!0,width:t.perimeterLineWidth,polygonOffset:!0,renderOccluded:pe.m$.OccludeAndTransparent,isDecoration:!0}),this._intersectedPerimeter=new le.t({view:i,attached:!0,width:t.perimeterLineWidth,color:t.intersectingLineColor,polygonOffset:!0,renderOccluded:pe.m$.OccludeAndTransparent,isDecoration:!0}),this._projectionLines=new le.t({view:i,attached:!0,width:t.projectionLineWidth,stipplePattern:(0,We.wk)(t.projectionLineStippleSize),polygonOffset:!0,renderOccluded:pe.m$.OccludeAndTransparent,isDecoration:!0}),this._measurementArea=new ke({view:i,attached:!0,isDecoration:!0});const s={attached:!0,view:i,isDecoration:!0};this._areaLabel=new oe.N((0,Y.A)((0,Y.A)({},s),{},{fontSize:qe.Large})),this._perimeterLengthLabel=new oe.N((0,Y.A)((0,Y.A)({},s),{},{fontSize:qe.Small})),this.addHandles([(0,c.wB)(()=>[e.mode,this.visible,e.unit,e.measurementData,e.stagedPoint],()=>this._update(),c.pc),(0,c.wB)(()=>{var e;return null===(e=i.state)||void 0===e?void 0:e.camera},()=>this._updateLabels(),c.pc),(0,Fe.oQ)(()=>this._updateMessageBundle()),(0,c.wB)(()=>this._parameters,e=>{let{accentColor:t,transparentAccentColor:i,transparentContrastColor:s,textColor:n,textBackgroundColor:r,textCalloutColor:a}=e;const{_path:o,_intersectedPath:l,_perimeter:h,_projectionLines:u,_measurementArea:d,_areaLabel:c,_perimeterLengthLabel:p}=this;o.color=t,l.color=t,h.color=t,u.color=t,d.color1=i,d.color2=s,c.textColor=n,c.backgroundColor=r,c.calloutColor=a,p.textColor=n,p.backgroundColor=r,p.calloutColor=a},c.Vh)]),this._updateMessageBundle()}destroy(){this._measurementArea=(0,r.pR)(this._measurementArea),this._path=(0,r.pR)(this._path),this._intersectedPath=(0,r.pR)(this._intersectedPath),this._perimeter=(0,r.pR)(this._perimeter),this._intersectedPerimeter=(0,r.pR)(this._intersectedPerimeter),this._areaLabel=(0,r.pR)(this._areaLabel),this._perimeterLengthLabel=(0,r.pR)(this._perimeterLengthLabel),this._projectionLines=(0,r.pR)(this._projectionLines),this.set("view",null)}_update(){if(this.destroyed||!this.view.ready||!this.view.renderCoordsHelper)return;const{analysisViewData:{measurementData:e},analysisViewData:t}=this;null!=e&&(this._updateViewData(e,t.path),this._updateOrigin(),this._updatePathSegments(),this._updatePerimeterSegments(),this._updateArea(),this._updateProjectionLines(),this._updateLabels())}_updateViewData(e,t){const i=e.validMeasurement,s="geodesic"===e.actualMeasurementMode,n=s?e.geodesicArea:e.area;let r=1;if(n){const e=ne(n,this.analysisViewData.unit);r=(0,p.Vr)(Math.sqrt(e.value)/Math.sqrt(300)),r*=Math.sqrt((0,_.oU)(1,e.unit,"square-meters")),r=(0,_.oU)(r,"meters",this._renderUnits)}const a={validMeasurement:i,numVertices:e.numVertices,hasStagedVertex:e.hasStagedVertex,path:t,mode:e.actualMeasurementMode,positionsRender:e.positionsRender,positionsFittedWorld:e.positionsFittedWorld,positionsFittedRender:e.positionsFittedRender,intersectingSegments:s?e.geodesicIntersectingSegments:e.intersectingSegments,triangleIndices:s?e.geodesicTriangleIndices:e.triangleIndices,areaCentroid:s?e.geodesicAreaCentroidRenderCoords:e.areaCentroidRenderCoords,perimeterLengthLabelSegmentIndex:0,area:s?e.geodesicArea:e.area,pathLength:s?e.geodesicPathLength:e.pathLength,perimeterLength:e.perimeterLength,checkerSize:r};this._set("viewData",a)}_updateOrigin(){const e=this.viewData;(0,G.ix)(e.positionsRender,this._origin),(0,ie.kN)(this._originTransform,this._origin),this._measurementArea.transform=this._originTransform,this._projectionLines.transform=this._originTransform}_createSegments(e){const t=this.viewData,i=this.view.renderCoordsHelper.spatialReference,s=t.mode,n=[],r=[],a=[],o=t.numVertices,l=t.validMeasurement?o:o-1;for(let u=0;u<l;++u){const l=t[e][u],h=t[e][(u+1)%o];let d=null;switch(s){case"euclidean":d=new Ee.C(l,h);break;case"geodesic":d=new Ee.J(l,h,i)}t.intersectingSegments.has(u)?a.push(d):r.push(d),n.push(d)}let h=null;return t.validMeasurement&&t.hasStagedVertex&&l>=2?h=n[n.length-2]:t.hasStagedVertex&&l>=1&&(h=n[n.length-1]),{all:n,nonIntersecting:r,intersecting:a,stagedSegment:h}}_updatePathSegments(){const{visible:e}=this,t=this._createSegments("positionsRender");this._path.setGeometryFromSegments(t.nonIntersecting,this._origin),this._path.visible=e,this._intersectedPath.setGeometryFromSegments(t.intersecting,this._origin),this._intersectedPath.visible=e,this._pathSegments=t.all}_updatePerimeterSegments(){const e=this.visible&&"euclidean"===this.viewData.mode&&this.viewData.path.numVertices>2,t=this._createSegments("positionsFittedRender");this._perimeter.setGeometryFromSegments(t.nonIntersecting,this._origin),this._perimeter.visible=e,this._intersectedPerimeter.setGeometryFromSegments(t.intersecting,this._origin),this._intersectedPerimeter.visible=e,this._perimeterSegments=t.all}_updateArea(){const e=this.viewData;switch(e.mode){case"euclidean":this._updateAreaEuclidean(e);break;case"geodesic":this._updateAreaGeodesic()}}_updateAreaEuclidean(e){const t=this.visible;e.validMeasurement&&0===e.intersectingSegments.size&&e.triangleIndices?(this._measurementArea.geometry={uv:e.positionsFittedWorld,position:e.positionsFittedRender,triangleIndices:e.triangleIndices},this._measurementArea.size=[e.checkerSize,e.checkerSize],this._measurementArea.visible=t):this._measurementArea.visible=!1}_updateAreaGeodesic(){this._measurementArea.visible=!1}_updateProjectionLines(){const e=this.viewData,t=this.visible,i=e.mode,s=e.numVertices;if(s>0&&e.validMeasurement&&"euclidean"===i){const i=[];for(let t=0;t<s;++t){const s=(0,f.vt)();(0,y.d)(s,e.positionsRender[t],this._origin);const n=(0,f.vt)();(0,y.d)(n,e.positionsFittedRender[t],this._origin),i.push([s,n])}this._projectionLines.geometry=i,this._projectionLines.visible=t}else this._projectionLines.geometry=null,this._projectionLines.visible=!1}_updateLabels(){if(this.destroyed)return;const{viewData:e}=this,{area:t,path:i}=e;if(!i)return;const s=this.visible,n=this._areaLabel,r=this._perimeterLengthLabel,a=e.validMeasurement;n.visible=!0,r.visible=!0;let o=!1;const l=function(e,t,i){return e&&t&&(0,te.zJ)(e,t,(0,_.cT)(t.value,t.unit,i))}(this.messages,t,this.analysisViewData.unit);if(null!=l&&s&&(n.geometry={type:"point",point:e.areaCentroid},n.text=l,o=e.validMeasurement&&0===e.intersectingSegments.size),this._set("areaLabel",l),s&&a&&0===e.intersectingSegments.size){const t="geodesic"===e.mode,i=t?e.pathLength:e.perimeterLength,s=function(e,t,i){return e&&t&&(0,te.zJ)(e,t,ae(t,i))}(this.messages,i,this.analysisViewData.unit);this._set("perimeterLengthLabel",s),r.distance=this._parameters.labelDistance,r.anchor="top",r.text=s;let n=!0;for(let a=0;a<e.numVertices;++a){const i=(e.perimeterLengthLabelSegmentIndex+a)%e.numVertices,s=t?this._pathSegments[i]:this._perimeterSegments[i];if(n=!0,r.geometry={type:"segment",segment:s,sampleLocation:"center"},!r.overlaps(this._areaLabel))break;n=!1}r.visible=n}else r.visible=!1;n.visible=o}_updateMessageBundle(){this.loadingMessages=!0,(0,Ue.ud)("esri/core/t9n/Units").then(e=>{this.messages=e,this.view&&this._update()}).finally(()=>{this.loadingMessages=!1})}};var qe,Ne;(0,s._)([(0,a.MZ)()],Be.prototype,"_parameters",null),(0,s._)([(0,a.MZ)()],Be.prototype,"view",void 0),(0,s._)([(0,a.MZ)()],Be.prototype,"messages",void 0),(0,s._)([(0,a.MZ)()],Be.prototype,"analysis",void 0),(0,s._)([(0,a.MZ)()],Be.prototype,"viewData",void 0),(0,s._)([(0,a.MZ)()],Be.prototype,"analysisViewData",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],Be.prototype,"areaLabel",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],Be.prototype,"perimeterLengthLabel",void 0),(0,s._)([(0,a.MZ)()],Be.prototype,"loadingMessages",void 0),(0,s._)([(0,a.MZ)()],Be.prototype,"visible",null),(0,s._)([(0,a.MZ)()],Be.prototype,"_renderUnits",null),Be=(0,s._)([(0,l.$)("esri.views.3d.analysis.AreaMeasurement.support.AreaMeasurementVisualization")],Be),(Ne=qe||(qe={}))[Ne.Small=12]="Small",Ne[Ne.Large=16]="Large";const je={validMeasurement:!1,numVertices:0,hasStagedVertex:!1,path:null,mode:null,positionsRender:null,positionsFittedWorld:null,positionsFittedRender:null,intersectingSegments:null,triangleIndices:null,areaCentroid:null,perimeterLengthLabelSegmentIndex:null,checkerSize:null,area:null,pathLength:null,perimeterLength:null};var $e=i(56002),Qe=i(50346),Ke=i(19451),Je=i(32535),Xe=i(70836),Ye=i(7947),et=i(69539),tt=i(88321),it=i(76931),st=i(56121),nt=i(38317),rt=i(91175);class at{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.screenPoint=e,this.result=t}}class ot{constructor(e,t){this.scenePoint=e,this.mapPoint=t}}var lt=i(1307),ht=i(62577),ut=i(38386),dt=i(46576);class ct{constructor(e){this.vertexManipulators=[],this._destroyed=!1,this._isManipulatorsOwner=!0,this._visible=!0,this._listenerHandles=null,this._tempHandlePosition=(0,f.vt)();const{analysisViewData:t,manipulators:i,toolState:s,view:n,visible:r}=e;this._analysisViewData=t,this._toolState=s,null!=i?(this._manipulators=i,this._isManipulatorsOwner=!1):this._manipulators=new ut.t,this._view=n,this._intersector=(0,dt.T)(n.state.viewingMode);const a=(0,nt.UM)(this._handleColor),o=[new rt.M((0,ht.CM)(a,1,32,32))],l=new st.q({view:n,renderObjects:o});l.available=!1,l.radius=mt,l.interactive=!1,this._manipulators.add(l),this._cursorManipulator=l,this._cursorManipulatorMaterial=a,this._laserLine=new lt.o({view:n,attached:!0,style:{glowWidth:pt,glowFalloff:gt,innerWidth:_t},isDecoration:!0}),this._updateVisibility(null===r||void 0===r||r)}destroy(){this._listenerHandles=(0,r.pR)(this._listenerHandles),this._isManipulatorsOwner?this._manipulators=(0,r.pR)(this._manipulators):this._manipulators=null,this._laserLine=(0,r.pR)(this._laserLine),this._destroyed=!0}get destroyed(){return this._destroyed}get visible(){return this._visible}set visible(e){e?this.show():this.hide()}get testData(){}show(){this._setVisibility(!0)}hide(){this._setVisibility(!1)}_setVisibility(e){this._destroyed||this._visible===e||this._updateVisibility(e)}_updateVisibility(e){this._visible=e,this._laserLine.visible=e,e?(this._initializeListeners(),this._updateAll()):(this._destroyListeners(),this.vertexManipulators.forEach(e=>{let{manipulator:t}=e;return this._removeVertexManipulator(t)}),this.vertexManipulators=[],this._view.cursor=null)}vertexHandleAt(e,t){const i=this._manipulators.intersect(e,t);return null===i||void 0===i?void 0:i.metadata}pick(e){const t=this._view.spatialReference,i=(0,it.WA)(e.screenPoint);this._view.sceneIntersectionHelper.intersectToolIntersectorScreen(i,this._intersector);const s=this._intersector.results.min,n=(0,f.vt)();if(!s.getIntersectionPoint(n))return null;const r=this._view.renderCoordsHelper.fromRenderCoords(n,new q.A({spatialReference:t}));return null==r?null:new ot(n,r)}_updateAll(){this._visible&&(this._updateVertexManipulators(),this._updateLaserLine())}_createVertexManipulator(){const e=(0,nt.UM)(this._handleColor),t=[new rt.M((0,ht.CM)(e,1,32,32))],i=new st.q({view:this._view,renderObjects:t});return i.radius=mt,this._manipulators.add(i),{manipulator:i,material:e}}_removeVertexManipulator(e){this._manipulators.remove(e)}_updateVertexManipulators(){const{viewData:e}=this._analysisViewData,t=this._analysisViewData.path?this._analysisViewData.path.vertices:[],i=this.vertexManipulators;(function(e,t,i,s){for(;e.length<t;)e.push(i());if(s)for(;e.length>t;)s(e.pop());else e.length=t})(i,t.length,()=>this._createVertexManipulator(),e=>{let{manipulator:t}=e;return this._removeVertexManipulator(t)}),i.forEach((i,s)=>{let{manipulator:n}=i;n.metadata=t[s],n.renderLocation=e.positionsRender[s],n.cursor=0===s&&"drawing"===this._toolState.polygonState?"crosshair":null}),"drawing"===this._toolState.polygonState&&null!=this._analysisViewData.stagedPoint?(this._cursorManipulator.available=!0,this._cursorManipulator.location=this._analysisViewData.stagedPoint):this._cursorManipulator.available=!1}get _handleColor(){return(0,ee.f6)(this._view.effectiveTheme.accentColor,.5)}_getFocusPoint(){const{lastDraggedVertex:e}=this._analysisViewData;switch(this._toolState.polygonState){case"drawing":return null!=this._analysisViewData.stagedPoint?this._analysisViewData.stagedPoint:null!=e?this._analysisViewData.path.getVertexPositionAsPoint(e):this._analysisViewData.path.lastPoint;case"editing":return null!=e?this._analysisViewData.path.getVertexPositionAsPoint(e):null;default:return this._analysisViewData.stagedPoint}}_updateLaserLine(){const e="measured"!==this._toolState.polygonState&&this._toolState.active,t=this._getFocusPoint();if(e&&null!=t){const e=this._tempHandlePosition;this._view.renderCoordsHelper.toRenderCoords(t,e),this._laserLine.heightManifoldTarget=e}else this._laserLine.heightManifoldTarget=null}_initializeListeners(){this._listenerHandles=new tt.A,this._listenerHandles.add([(0,c.wB)(()=>this._toolState.polygonState,()=>this._updateLaserLine()),(0,c.wB)(()=>this._analysisViewData.viewData,()=>this._updateAll(),c.OH),(0,c.wB)(()=>({lastDraggedVertex:this._analysisViewData.lastDraggedVertex,cursorPoint:this._analysisViewData.stagedPoint}),()=>this._updateLaserLine()),(0,c.wB)(()=>this._toolState.active,()=>this._updateAll()),(0,c.wB)(()=>this._view.effectiveTheme.accentColor,e=>{const t=(0,ee.f6)(e,.5);for(const{material:o}of this.vertexManipulators)o.setParameters({color:t});this._cursorManipulatorMaterial.setParameters({color:t});const i=et.A.toUnitRGB(e),s=et.A.toUnitRGB((0,ee.bJ)(e)),n=.75*e.a,r=this._laserLine,a=r.style;r.style=(0,Y.A)((0,Y.A)({},a),{},{glowColor:i,innerColor:s,globalAlpha:n})},{initial:!0,equals:ee.hw})])}_destroyListeners(){this._listenerHandles=(0,r.pR)(this._listenerHandles)}}const pt=8,gt=8,_t=1,mt=5;var vt=i(5109),yt=i(17046),ft=i(82307),xt=i(13284),wt=i(61237),Mt=i(82887),Pt=i(14318),Vt=i(70330),St=i(11500);let Lt=class extends vt.k{constructor(e){super(e),this._updatingHandles=new Ke.U,this.polygonState="initial",this.removeIncompleteOnCancel=!1,this.manipulators=new ut.t,this._getSnappingContext=(0,$e.B)(e=>new xt.e({elevationInfo:{mode:"absolute-height",offset:0},pointer:e,editGeometryOperations:new K.p(new Q.ZE("point",(0,$.BV)(!0,!1,this.view.spatialReference)),this.view.state.viewingMode),visualizer:new Xe.s}))}initialize(){const{view:e,analysisViewData:t,manipulators:i,visible:s}=this;this.measurementView=new ct({view:e,analysisViewData:t,toolState:this,manipulators:i,visible:s});const n=(0,Mt.X)(e);this._snappingManagerResult=n,this.addHandles(n),this._snappingOperation=new Pt.O({view:e}),this._updatingHandles.add(()=>this.stagedPoint,e=>{this.analysisViewData.stagedPoint=null!=e?(0,Je.EL)(e,new q.A):null},c.pc),(0,Vt.BY)(this,()=>{var e;const t=null!==(e=this.view.inputManager.latestPointerType)&&void 0!==e?e:"mouse",i=this._getSnappingContext(t);this._updatingHandles.addPromise((0,Qe.QZ)(this._snappingOperation.snapAgainNearPreviousMapPoint(this._snappingManager,i)))}),this._setupManipulators(),this.addHandles([(0,c.z7)(()=>"measured"===this.state,()=>this.finishToolCreation(),c.pc),this.analysisViewData.path.on("change",()=>{const e=this.analysisViewData.path;"initial"!==this.polygonState||e.isEmptyPolygon||(e.isValidPolygon?this.polygonState="measured":this.polygonState="drawing")})])}destroy(){this.measurementView.destroy(),this._set("measurementView",null),this._updatingHandles=(0,r.pR)(this._updatingHandles)}get _snappingManager(){return this._snappingManagerResult.snappingManager}get state(){return 0===this.analysisViewData.path.numVertices?"ready":this.analysisViewData.path.isValidPolygon&&"editing"!==this.polygonState?"measured":"measuring"}get cursor(){return this.active?"crosshair":null}get updating(){return this._updatingHandles.updating||this._snappingManager.updating}get stagedPoint(){return this._snappingOperation.stagedPoint}set stagedPoint(e){this._snappingOperation.stagedPoint=e}get snappingOptions(){return this._snappingManager.options}finishMeasurement(){const{path:e}=this.analysisViewData;e.numVertices<=2||(e.close(),this.polygonState="measured",this._resetSnappingState(),this.active&&(this.view.activeTool=null))}resetCreated(){super.resetCreated(),this._resetSnappingState(),this.polygonState="initial","measured"===this.state&&(this.polygonState="measured",this.finishToolCreation())}onShow(){this.measurementView.show()}onHide(){this.measurementView.hide()}onDeactivate(){this._resetSnappingState()}onInputEvent(e){switch(e.type){case"immediate-double-click":this._handleImmediateDoubleClick(e);break;case"immediate-click":this._handleImmediateClick(e);break;case"pointer-move":this._handlePointerMove(e);break;case"drag":this._handleDrag(e);break;case"key-down":this._handleKeyDown(e)}}_setupManipulators(){const e=e=>e.events.on("grab-changed",()=>{if(this.analysisViewData.path.isValidPolygon){const e=this.manipulators.some(e=>e.manipulator.grabbing);this.polygonState=e?"editing":"measured"}}),t=t=>{this.addHandles([(0,yt.Xt)(t,(e,t,i,s)=>{const n=(0,Ye.z7)(e),r=e.metadata,a=this._snappingManager,o=this._getSnappingContext(s),l=this._updatingHandles,{snappingStep:h,cancelSnapping:u}=(0,wt.L)({snappingManager:a,snappingContext:o,updatingHandles:l});i=i.next(n).next(t=>(this.analysisViewData.lastDraggedVertex=null,this.analysisViewData.path.setVertexPosition(r,d),e.location=d,t)).next(u),t.next(n).next((0,Ye.xk)(this.view)).next(...h).next(t=>{e.location=t.mapEnd,this.analysisViewData.lastDraggedVertex="end"===t.action?null:r,this.analysisViewData.path.setVertexPosition(r,(0,Je.EL)(t.mapEnd))});const d=(0,Je.EL)(this.analysisViewData.path.getVertexPositionAsPoint(r))}),e(t)],t)};this.manipulators.forEach(e=>{let{manipulator:i}=e;t(i)}),this.addHandles([this.manipulators.on("after-add",e=>{let{item:{manipulator:i}}=e;t(i)}),this.manipulators.on("after-remove",e=>{let{item:{manipulator:t}}=e;return this.removeHandles(t)})])}_handleImmediateDoubleClick(e){(0,T.s7)(e)&&("drawing"===this.polygonState&&this.finishMeasurement(),e.stopPropagation())}_handleDrag(e){"editing"===this.polygonState&&e.stopPropagation()}_handleImmediateClick(e){if(!(0,T.s7)(e))return;const t=(0,St.ZV)(e),{pointerType:i}=e;if(this.active)switch(this.polygonState){case"initial":case"measured":if(this._addVertexAt(t,i))return this.stagedPoint=null,this.polygonState="drawing",void e.stopPropagation();break;case"drawing":{const s=this.measurementView.vertexHandleAt(t,i);if(null==s){if(this._addVertexAt(t,i))return this.stagedPoint=null,void e.stopPropagation()}else 0===s.index&&(this.finishMeasurement(),e.stopPropagation());break}}"mouse"===e.pointerType&&this._hoverAt(t)}_handlePointerMove(e){if("mouse"===e.pointerType){const t=(0,St.ZV)(e);this._hoverAt(t)}}_handleKeyDown(e){const{path:t}=this.analysisViewData;e.key===ft.NE.complete&&"drawing"===this.polygonState&&t.numVertices>=3&&(this.stagedPoint=null,this.finishMeasurement(),e.stopPropagation())}_hoverAt(e){const{polygonState:t}=this;if(this.active&&Ct.has(t)){const t=this._pick(e);if(null!=(null===t||void 0===t?void 0:t.mapPoint)){const e=this._getSnappingContext("mouse");this._updatingHandles.addPromise((0,Qe.QZ)(this._snappingOperation.snap({point:t.mapPoint},this._snappingManager,e)))}}else this.stagedPoint=null}_addVertexAt(e,t){const i=this._pick(e),s=null===i||void 0===i?void 0:i.mapPoint;if(null==s)return!1;this.analysis.valid&&"measured"===this.polygonState&&(this.analysis.clear(),this._set("created",!1),this.polygonState="initial");const n=this._getSnappingContext(t),r=this._snappingOperation.update({point:s},this._snappingManager,n),a=(0,Je.EL)(r,new q.A);return this.analysisViewData.path.add(a),!0}_pick(e){const t=new at(e);return this.measurementView.pick(t)}_resetSnappingState(){this._snappingManager.doneSnapping(),this._snappingOperation.abort(),this._snappingOperation.stagedPoint=null}get test(){}};(0,s._)([(0,a.MZ)({readOnly:!0})],Lt.prototype,"state",null),(0,s._)([(0,a.MZ)()],Lt.prototype,"polygonState",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],Lt.prototype,"cursor",null),(0,s._)([(0,a.MZ)()],Lt.prototype,"measurementView",void 0),(0,s._)([(0,a.MZ)()],Lt.prototype,"removeIncompleteOnCancel",void 0),(0,s._)([(0,a.MZ)({constructOnly:!0})],Lt.prototype,"view",void 0),(0,s._)([(0,a.MZ)({constructOnly:!0})],Lt.prototype,"analysis",void 0),(0,s._)([(0,a.MZ)({constructOnly:!0})],Lt.prototype,"analysisViewData",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],Lt.prototype,"manipulators",void 0),(0,s._)([(0,a.MZ)()],Lt.prototype,"updating",null),(0,s._)([(0,a.MZ)()],Lt.prototype,"stagedPoint",null),(0,s._)([(0,a.MZ)()],Lt.prototype,"snappingOptions",null),Lt=(0,s._)([(0,l.$)("esri.views.3d.interactive.measurementTools.areaMeasurement3D.AreaMeasurement3DTool")],Lt);const Ct=new Set(["initial","drawing","measured"]);var At=i(10260),bt=i(66678),Dt=i(23739);let Ot=class extends((0,u.P)(n.A)){constructor(e){super(e),this.type="area-measurement-view-3d",this.analysis=null,this.measurementData=null,this.lastDraggedVertex=null,this.stagedPoint=null,this.mode=d.G.Auto,this.tool=null,this.userOperation=null}initialize(){const{analysis:e,view:t}=this;this.path=new J({view:t,areaMeasurement:e}),this._analysisVisualization=new Be({view:t,analysis:e,analysisViewData:this}),this.addResolvingPromise(Promise.all([(0,bt.c)(),(0,Dt.V)()]).then(i=>{let[s,n]=i;this.destroyed||(this._analysisController=new U({view:t,analysis:e,analysisViewData:this,geodesicAreaMeasurementUtils:s,geodesicLengthMeasurementUtils:n}))})),this.addHandles((0,At.Hd)(this,Lt))}destroy(){(0,At.aS)(this),this.userOperation=(0,r.DC)(this.userOperation),this._analysisController=(0,r.pR)(this._analysisController),this._analysisVisualization=(0,r.pR)(this._analysisVisualization),this.path.destroy()}get updating(){var e;return!(null===(e=this._analysisVisualization)||void 0===e||!e.loadingMessages)}get result(){const{measurementData:e}=this;if(null==e)return{area:null,mode:null,perimeter:null};const{unit:t}=this;if("euclidean"===e.actualMeasurementMode){const{area:i,perimeterLength:s}=e;return{area:null!=i?ne(i,t):null,perimeter:null!=s?re(s,t):null,mode:"euclidean"}}const{geodesicArea:i,pathLength:s}=e;return{area:null!=i?ne(i,t):null,perimeter:null!=s?re(s,t):null,mode:"geodesic"}}get viewData(){return this._analysisVisualization.viewData}get areaLabel(){return this._analysisVisualization.areaLabel}get perimeterLengthLabel(){return this._analysisVisualization.perimeterLengthLabel}get validMeasurement(){return this.path.isValidPolygon}get unit(){var e;return null!==(e=this.analysis.unit)&&void 0!==e?e:(0,h.c)(this.view)}get testData(){}place(e){return(0,At.ZX)(this,{placementOptions:e})}};(0,s._)([(0,a.MZ)()],Ot.prototype,"_analysisVisualization",void 0),(0,s._)([(0,a.MZ)()],Ot.prototype,"_analysisController",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],Ot.prototype,"type",void 0),(0,s._)([(0,a.MZ)({constructOnly:!0,nonNullable:!0})],Ot.prototype,"analysis",void 0),(0,s._)([(0,a.MZ)()],Ot.prototype,"updating",null),(0,s._)([(0,a.MZ)()],Ot.prototype,"result",null),(0,s._)([(0,a.MZ)()],Ot.prototype,"measurementData",void 0),(0,s._)([(0,a.MZ)()],Ot.prototype,"viewData",null),(0,s._)([(0,a.MZ)()],Ot.prototype,"areaLabel",null),(0,s._)([(0,a.MZ)()],Ot.prototype,"perimeterLengthLabel",null),(0,s._)([(0,a.MZ)()],Ot.prototype,"validMeasurement",null),(0,s._)([(0,a.MZ)()],Ot.prototype,"path",void 0),(0,s._)([(0,a.MZ)()],Ot.prototype,"lastDraggedVertex",void 0),(0,s._)([(0,a.MZ)()],Ot.prototype,"stagedPoint",void 0),(0,s._)([(0,a.MZ)()],Ot.prototype,"mode",void 0),(0,s._)([(0,a.MZ)()],Ot.prototype,"unit",null),(0,s._)([(0,a.MZ)()],Ot.prototype,"tool",void 0),(0,s._)([(0,a.MZ)()],Ot.prototype,"userOperation",void 0),Ot=(0,s._)([(0,l.$)("esri.views.3d.analysis.AreaMeasurementAnalysisView3D")],Ot);const Rt=Ot}}]);
//# sourceMappingURL=94089.58acff81.chunk.js.map